# EpiphanyV2 — Persona5 强风格 UX/UI 完整设计规范（Web）

> **版本**: 2.0
> **更新日期**: 2025-01-XX
> **适用范围**: 仅 Web（`apps/web`）。API/Worker 行为以契约为准，不在本规划里改动。

## 目标

把现有 `apps/web` 的"功能已通、视觉偏中性"升级为 **强 Persona5（P5）** 的统一体验。

**核心追求**：
1. **视觉冲击** — 每个页面都像一张海报，让用户感受到"反叛 UI"的张力
2. **仪式感交互** — 关键操作（投票、发言、身份创建）应有戏剧性时刻
3. **功能不退步** — 严格遵守 `api-contract.md` / `shared-contracts` / `PROJECT_REFERENCE.md` 的稳定边界

---

# 第一部分：设计哲学

## 1.1 设计北极星

来源：`docs/stage01/design.md`（必须遵守）

### 核心视觉语法（永远成立）

| 原则 | 说明 | 具体实现 |
|-----|------|---------|
| **Ink 描边是骨架** | 所有可交互元素必须有明确边界 | 4–5px `#1A1A1D` 实边 |
| **偏移硬阴影** | 层级感来自位移，不是模糊 | `4px 4px 0` 优先，拒绝 `blur` |
| **斜切与旋转** | 制造紧张感和手工拼贴感 | ±0.5°~2° 旋转，12px 斜切角 |
| **RebelRed 是主旋律** | 红色代表行动、警告、反对立场 | `#FF0033` 用于 CTA/con/error |
| **材质可感知** | 避免数码扁平感 | 噪点 9%、半调网点、纸张纹理 |
| **符号化引导** | 用强图形而非细线图标 | `▶` `◉` `▲` 三角箭头 |

### 绝对禁止

- ❌ 玻璃拟态（毛玻璃、柔和渐变、半透明叠层）
- ❌ 低对比中性 UI（1px 边框、轻阴影、灰白卡片堆叠）
- ❌ 过度装饰导致阅读困难（旋转 > 3°、纹理遮盖文字）

---

## 1.2 Persona5 的"灵魂"（超越静态样式）

Persona5 的魔力不仅是粗边框和红色，更在于**动态仪式**：

### 视觉母题

| 母题 | 描述 | 应用场景 |
|-----|------|---------|
| **Calling Card** | 斜贴的标签条，像贴在墙上的通缉令 | 标题、Tooltip、选中态标签 |
| **对角撕裂** | 页面/容器用对角线分割，像被撕开 | 双栏分隔、模态框背景 |
| **印刷打击** | 操作反馈像活字印刷的"啪"一声落下 | 按钮点击、投票确认 |
| **漫画网点** | 半调网点做底，信息层压上去 | 背景、加载骨架、空态插图 |
| **剪纸裁切** | 多边形 `clip-path` + 错位阴影 | 卡片、徽章、面板 |

### 动效哲学

| 类型 | Persona5 感觉 | 实现方式 |
|-----|--------------|---------|
| **出现** | 快速"弹入"，不是渐隐 | `transform: scale(0.95)` → `scale(1)` + `opacity`，80-120ms |
| **悬停** | 轻微浮起 + 阴影加深 | `translate(-2px, -2px)` + shadow offset 增加 |
| **点击** | 下压打击感 | `translate(2px, 2px)` + shadow offset 归零，50ms |
| **错误** | 短促震动，像被弹回 | `shake` 动画 3 次，150ms，尊重 `prefers-reduced-motion` |
| **成功** | 印章盖下的满足感 | 绿色 `✓` 图标 + 轻微放大回弹 |

---

## 1.3 色彩系统

### 基础色

| Token | Hex | 用途 |
|-------|-----|------|
| `--ink` | `#1A1A1D` | 主描边、深色文字、分割线 |
| `--paper` | `#FFFFFF` | 深色面上的文字、卡片内衬 |
| `--concrete-300` | `#C9C9C9` | 默认背景（"混凝土墙面"） |
| `--concrete-200` | `#E5E5E5` | 卡片底、图表底 |
| `--concrete-100` | `#D4D4D4` | 次级文字/弱对比 |

### 强调色（高饱和）

| Token | Hex | 语义 |
|-------|-----|------|
| `--rebel-red` | `#FF0033` | 主 CTA、强警告、con 立场 |
| `--acid` | `#FACC15` | 强调、中立立场、关键数值 |
| `--electric` | `#2563EB` | pro 立场、信息性高亮 |

### 立场色编码（必须统一）

| 立场 | 填充色 | 描边 | 应用 |
|-----|-------|------|------|
| 支持 (pro) | `Electric` | `Ink` | 节点、徽章、连接线高亮 |
| 反对 (con) | `RebelRed` | `Ink` | 节点、徽章、连接线高亮 |
| 中立 (neutral) | `Acid` | `Ink` | 节点、徽章 |

---

## 1.4 排版系统

### 字体栈

| 用途 | 字体 | Fallback | 特征 |
|-----|------|----------|------|
| **Display（标题/标签）** | Bebas Neue | Oswald, system-ui | 全大写、窄体、大字距 |
| **Body（正文）** | LXGW WenKai | Noto Sans SC, system-ui | 中文优先、可读性强 |
| **Mono（数据/代码）** | JetBrains Mono | Courier New, monospace | 等宽、技术感 |

### 字体加载（Next.js）

```typescript
// app/layout.tsx
import { Bebas_Neue } from 'next/font/google'
import localFont from 'next/font/local'

const bebasNeue = Bebas_Neue({
  weight: '400',
  subsets: ['latin'],
  variable: '--font-display'
})

const lxgwWenKai = localFont({
  src: '../fonts/LXGWWenKai-Regular.ttf',
  variable: '--font-body'
})
```

### 排版层级

| 层级 | 字体 | 大小 | 行高 | 用途 |
|-----|------|------|------|------|
| H1 | Display | 48px | 1.1 | 页面主标题 |
| H2 | Display | 32px | 1.2 | 区块标题 |
| H3 | Display | 24px | 1.3 | 卡片标题 |
| Body | Body | 16px | 1.6 | 论点正文 |
| Caption | Body | 14px | 1.5 | 辅助说明 |
| Data | Mono | 14px | 1.4 | 数值、哈希、代码 |

---

# 第二部分：信息架构与导航

## 2.1 产品入口模式（类 Luma）

> **核心理念**：用户主要通过**分享链接**直接进入 Topic 详情页，而非通过首页浏览列表。
> 首页（`/topics`）是**次要入口**，主要服务于创建新议题和管理已参与的议题。

### 用户感知分离

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│   主要路径（80%+ 用户）                                                   │
│   ─────────────────────                                                 │
│   社交媒体/消息分享                                                       │
│         │                                                               │
│         ▼                                                               │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │               Topic 详情页 (/topics/:topicId)                   │   │
│   │               ════════════════════════════════                   │   │
│   │               这是产品的"主舞台"                                  │   │
│   │               用户在这里阅读、投票、发言、参与讨论                  │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│   次要路径（创建者/回访者）                                               │
│   ─────────────────────────                                             │
│   直接访问 / 书签                                                        │
│         │                                                               │
│         ▼                                                               │
│   ┌───────────────────┐     ┌───────────────────┐                       │
│   │  /topics          │     │  /my              │                       │
│   │  ───────          │     │  ────             │                       │
│   │  创建新议题        │     │  管理我的参与      │                       │
│   │  发现公开议题      │     │  查看投票记录      │                       │
│   │  （轻量级列表）    │     │  一键撤回         │                       │
│   └───────────────────┘     └───────────────────┘                       │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 设计含义

| 页面 | 定位 | 设计投入 |
|-----|------|---------|
| `/topics/:topicId` | **主舞台** | 最高优先级，完整 P5 体验 |
| `/topics` | 工具页 | 简洁实用，不需要"首页感" |
| `/my` | 管理页 | 功能导向，身份管理+资产管理 |
| `/topics/new` | 创建流程 | 可独立访问，嵌入式体验 |

## 2.2 页面结构

```
/topics                 → Topic 列表（次要入口，创建+发现）
/topics/new             → 创建 Topic（可独立访问）
/topics/:topicId        → Topic 详情（★ 主舞台 ★）
/my                     → My Activity（客户端聚合，管理页）
```

## 2.3 Topic 详情页 TopBar（主舞台导航）

Topic 详情页是独立完整的体验，TopBar 服务于**当前议题**而非全站导航：

```
┌─────────────────────────────────────────────────────────────────────────┐
│  ┌──────────┐                                      ┌─────────────────┐  │
│  │ ◀ 返回   │      议题标题（截断显示）              │ ◆ 84  │ ●●●●  │  │
│  │ (可选)   │      "人工智能是否会取代..."          │ 余额   │ 身份  │  │
│  └──────────┘                                      └─────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
```

### TopBar 组成（Topic 详情页）

| 区域 | 内容 | 交互 |
|-----|------|------|
| **左** | 返回按钮（可选，仅从列表页进入时显示） | 返回上一页 |
| **中** | Topic 标题（截断） | 点击滚动到顶部 |
| **右-1** | Balance | 显示当前余额 `◆ 84` |
| **右-2** | Identity 状态 | 显示指纹或"设置身份" |

### 关键设计决策

1. **无全站 Logo**：Topic 页面是独立的，不需要强调"平台感"
2. **标题居中**：强调当前议题的重要性
3. **右侧信息密集**：余额和身份是参与讨论的关键信息
4. **返回按钮可选**：从分享链接进入时不显示（无处可返回）

## 2.4 列表页 TopBar（次要入口）

列表页是管理/发现功能，TopBar 更简洁：

```
┌─────────────────────────────────────────────────────────────────────────┐
│  ┌──────────┐                                      ┌─────┐  ┌────────┐  │
│  │ EP       │            TOPICS                    │ My  │  │+ 创建  │  │
│  │ (Logo)   │                                      │     │  │        │  │
│  └──────────┘                                      └─────┘  └────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
```

### TopBar 视觉规格

- 高度：`56px`
- 背景：`--ink` 纯色
- Logo 文字：`--paper` + `--rebel-red` 描边
- 导航链接：`--paper`，hover 时 `--acid` 下划线
- 分隔：无分隔线，靠间距区分

---

## 2.5 Topic 详情页布局（核心：双栏架构）

这是应用的核心页面，必须实现**左右双栏**布局：

```
┌─────────────────────────────────────────────────────────────────────────┐
│                            TopBar (56px)                                │
├────────────────────────────────────┬────────────────────────────────────┤
│                                    │                                    │
│         LEFT COLUMN                │         RIGHT COLUMN               │
│         视图区 (60%)               │         对话流 (40%)               │
│                                    │                                    │
│  ┌──────────────────────────────┐  │  ┌──────────────────────────────┐  │
│  │ Topic Header                 │  │  │ Selected Node Card           │  │
│  │ Title + Status + Balance     │  │  │ (Calling Card 风格)          │  │
│  └──────────────────────────────┘  │  └──────────────────────────────┘  │
│                                    │                                    │
│  ┌──────────────────────────────┐  │  ┌──────────────────────────────┐  │
│  │ ViewMode Tabs                │  │  │ Children Tabs                │  │
│  │ [Focus] [Overview] [God]     │  │  │ [最热] [最新]                │  │
│  └──────────────────────────────┘  │  └──────────────────────────────┘  │
│                                    │                                    │
│  ┌──────────────────────────────┐  │  ┌──────────────────────────────┐  │
│  │                              │  │  │ Children List                │  │
│  │     Visualization Area       │  │  │ (滚动区域)                   │  │
│  │                              │  │  │                              │  │
│  │  - FocusView (树)            │  │  │  ┌────────────────────────┐  │  │
│  │  - SunburstView (旭日)       │  │  │  │ Argument Card          │  │  │
│  │  - GodView (语义图)          │  │  │  │ stance色条 + 摘要      │  │  │
│  │                              │  │  │  └────────────────────────┘  │  │
│  │                              │  │  │                              │  │
│  └──────────────────────────────┘  │  └──────────────────────────────┘  │
│                                    │                                    │
│                                    │  ┌──────────────────────────────┐  │
│                                    │  │ Reply + Vote Deck            │  │
│                                    │  │ (固定底部)                   │  │
│                                    │  └──────────────────────────────┘  │
│                                    │                                    │
├────────────────────────────────────┴────────────────────────────────────┤
│                     对角撕裂分隔线 (SVG 锯齿)                            │
└─────────────────────────────────────────────────────────────────────────┘
```

### 双栏分隔设计

左右栏之间使用**对角撕裂分隔线**：

```css
.column-divider {
  width: 8px;
  background:
    linear-gradient(135deg, var(--ink) 25%, transparent 25%),
    linear-gradient(-135deg, var(--ink) 25%, transparent 25%);
  background-size: 8px 8px;
}
```

### 响应式断点

| 断点 | 布局 |
|-----|------|
| ≥ 1024px | 双栏并排（60/40） |
| 768-1023px | 双栏并排（50/50） |
| < 768px | 单栏堆叠（视图在上，对话流在下，可切换） |

---

# 第三部分：关键用户旅程

## 3.1 Flow A：首页（议题宇宙 — 聚合旭日图）

> **核心概念**：首页是一个**可视化的议题宇宙**，用旭日图聚合展示所有公开议题。
> 这不是传统的列表页，而是一个**数据艺术品**——让用户一眼看到 "Epiphany" 的全貌。

### 3.1.1 设计理念

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│   传统首页                          本产品首页                           │
│   ────────                          ────────────                         │
│   ┌─────────────────┐              ┌─────────────────────────────────┐  │
│   │ Hero Banner     │              │                                 │  │
│   ├─────────────────┤              │         ╭───────────────╮       │  │
│   │ Topic 1         │              │      ╭──┤   议题宇宙    ├──╮    │  │
│   │ Topic 2         │      →       │    ╭─┤  │   (旭日图)    │  ├─╮  │  │
│   │ Topic 3         │              │    │ ╰──┴───────────────┴──╯ │  │  │
│   │ ...             │              │    ╰─────────────────────────╯  │  │
│   └─────────────────┘              │                                 │  │
│                                    └─────────────────────────────────┘  │
│   无聊的列表                         一眼看到全貌的数据艺术品              │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.1.2 页面布局

```
┌─────────────────────────────────────────────────────────────────────────┐
│ ┌─────────────────────────────────────────────────────────────────────┐ │
│ │                                                  [My]  [+ 创建议题] │ │
│ │                        (TopBar 极简，不抢视觉)                       │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│                                                                         │
│                    ┌─────────────────────────────────┐                  │
│                    │                                 │                  │
│                    │      ╭─────────────────────╮    │                  │
│                    │    ╭─┤                     ├─╮  │                  │
│                    │  ╭─┤ │    ┌─────────────┐  │ ├─╮│                  │
│                    │  │ │ │    │             │  │ │ ││                  │
│                    │  │ ╰─┤    │     EP      │  ├─╯ ││                  │
│                    │  │   │    │   (中心)    │  │   ││                  │
│                    │  │ ╭─┤    │             │  ├─╮ ││                  │
│                    │  │ │ │    └─────────────┘  │ │ ││                  │
│                    │  ╰─┤ │                     │ ├─╯│                  │
│                    │    ╰─┤                     ├─╯  │                  │
│                    │      ╰─────────────────────╯    │                  │
│                    │                                 │                  │
│                    │      (全屏旭日图，居中展示)       │                  │
│                    └─────────────────────────────────┘                  │
│                                                                         │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │ 当前 42 个活跃议题 · 总计 1,234 个观点 · 5,678 次投票            │    │
│  │ (底部统计条，半透明叠在旭日图上或固定底部)                         │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.1.3 旭日图结构设计

```
                              议题宇宙旭日图
                              ════════════════

                              ╭─────────────╮
                         ╭────┤  第二层     ├────╮
                    ╭────┤    │  热门论点   │    ├────╮
               ╭────┤    ╰────┴─────────────┴────╯    ├────╮
          ╭────┤    │                                  │    ├────╮
          │    │    │    ╭─────────────────────╮      │    │    │
          │    ╰────┤    │                     │      ├────╯    │
          │         │    │      第一层         │      │         │
          │         ╰────┤      Topics        ├────╯         │
          │              │                     │              │
          │              │   ┌─────────────┐   │              │
          │              ╰───┤             ├───╯              │
          │                  │    中心      │                  │
          ╰──────────────────┤     EP      ├──────────────────╯
                             │    Logo     │
                             │             │
                             └─────────────┘

层级说明：
─────────
• 中心圆：品牌 Logo "EP"（Epiphany）
• 第一层：每个扇区 = 一个 Topic
  - 扇区角度 ∝ Topic 热度（总票数 + 活跃度）
  - 扇区颜色 = Topic 主导立场（Pro=Electric, Con=RebelRed, Mixed=Acid）
• 第二层（可选）：每个 Topic 的热门子论点
  - 继承父扇区的色系，深浅区分
```

### 3.1.4 扇区视觉编码

| 属性 | 编码方式 | 说明 |
|-----|---------|------|
| **扇区角度** | `∝ Topic.totalVotes + Topic.argumentCount × 0.5` | 越热门，占据越大角度 |
| **扇区颜色** | 基于 Topic 内立场分布 | 支持>反对→Electric，反对>支持→RebelRed，均衡→Acid |
| **扇区透明度** | 基于 Topic 状态 | active=100%, frozen=70%, archived=40% |
| **描边** | 统一 `2px Ink` | 保持 P5 风格 |
| **选中态** | `4px RebelRed` + `8px Ink` 双层描边 | 与 Topic 内旭日图一致 |

### 3.1.5 颜色计算逻辑

```typescript
function getTopicColor(topic: Topic): string {
  const { proVotes, conVotes, neutralVotes } = topic.stanceDistribution
  const total = proVotes + conVotes + neutralVotes

  if (total === 0) return 'var(--concrete-200)' // 无投票

  const proRatio = proVotes / total
  const conRatio = conVotes / total

  if (proRatio > 0.6) return 'var(--electric)'      // 明显支持
  if (conRatio > 0.6) return 'var(--rebel-red)'     // 明显反对
  if (proRatio > 0.4 && conRatio > 0.4) return 'var(--acid)' // 激烈争议
  return 'var(--concrete-100)' // 中立为主
}
```

### 3.1.6 交互设计

#### Hover 效果

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│                         ╭─────────────────╮                             │
│                       ╭─┤                 ├─╮                           │
│                       │ │   ████████████  │ │◄── 悬停扇区高亮           │
│                       │ ╰─┬───────────────┴─╯   (亮度+10%, 描边加粗)    │
│                       │   │                                             │
│                       ╰───┼────────────────────────────────────╮        │
│                           │                                    │        │
│                           ▼                                    │        │
│        ┌─────────────────────────────────────────────────┐     │        │
│        │██████████████████████████████████████████████████│◄───┘        │
│        ├─────────────────────────────────────────────────┤    Calling   │
│        │                                                 │    Card      │
│        │  人工智能是否会取代人类工作？                     │    Tooltip   │
│        │                                                 │              │
│        │  ┌────────┐  ┌────────┐  ┌────────┐            │              │
│        │  │ ●156   │  │ 42节点 │  │ active │            │              │
│        │  │ 总票数  │  │        │  │        │            │              │
│        │  └────────┘  └────────┘  └────────┘            │              │
│        │                                                 │              │
│        │  立场分布: ██████████░░░░░ Pro 68%              │              │
│        │                                                 │              │
│        └─────────────────────────────────────────────────┘              │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

#### Click 效果

点击扇区 → **直接进入该 Topic 详情页**

```typescript
function onSectorClick(topic: Topic) {
  // 添加过渡动画：从旭日图"钻入"该 Topic
  router.push(`/topics/${topic.id}`)
}
```

#### 过渡动画（可选增强）

```css
/* 点击扇区后的"钻入"动画 */
@keyframes sunburst-drill-in {
  0% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.5);
    opacity: 0.8;
  }
  100% {
    transform: scale(3);
    opacity: 0;
  }
}

.sector-clicked {
  animation: sunburst-drill-in 400ms ease-in forwards;
}
```

### 3.1.7 中心区域设计

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│                         ┌─────────────────┐                             │
│                         │                 │                             │
│                         │      ████       │                             │
│                         │     ██████      │  ◄── EP Logo               │
│                         │      ████       │      (Persona5 风格)        │
│                         │                 │                             │
│                         │   EPIPHANY      │  ◄── 品牌名                 │
│                         │                 │      (Display 字体)         │
│                         │                 │                             │
│                         └─────────────────┘                             │
│                                                                         │
│  中心圆规格:                                                            │
│  - 直径: 旭日图总直径的 15-20%                                          │
│  - 背景: var(--ink)                                                    │
│  - Logo: var(--paper) + var(--rebel-red) 描边                          │
│  - 点击: 无交互（纯装饰）                                               │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.1.8 底部统计条

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                                                                 │    │
│  │  ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────────┐  │    │
│  │  │ 42      │    │ 1,234   │    │ 5,678   │    │ 实时更新 ●  │  │    │
│  │  │ 活跃议题 │    │ 观点    │    │ 投票    │    │ (SSE 指示) │  │    │
│  │  └─────────┘    └─────────┘    └─────────┘    └─────────────┘  │    │
│  │                                                                 │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                         │
│  样式:                                                                  │
│  - 位置: 固定底部                                                       │
│  - 背景: rgba(var(--ink-rgb), 0.9)                                     │
│  - 文字: var(--paper)                                                  │
│  - 边框: 顶部 3px solid var(--rebel-red)                               │
│  - 数字: Mono 字体，实时更新时有微小脉冲动画                             │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.1.9 空态设计（无议题时）

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│                                                                         │
│                         ┌─────────────────┐                             │
│                         │                 │                             │
│                         │      ████       │                             │
│                         │     ██████      │                             │
│                         │      ████       │                             │
│                         │                 │                             │
│                         │   THOUGHT       │                             │
│                         │    MARKET       │                             │
│                         │                 │                             │
│                         │  ─────────────  │                             │
│                         │                 │                             │
│                         │  这里还很安静   │                             │
│                         │  成为第一个     │                             │
│                         │  发起议题的人   │                             │
│                         │                 │                             │
│                         │ [+ 创建议题]    │◄── RebelRed 按钮            │
│                         │                 │                             │
│                         └─────────────────┘                             │
│                                                                         │
│                      (中心圆扩大，承载空态文案)                           │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.1.10 响应式设计

| 断点 | 布局调整 |
|-----|---------|
| ≥ 1024px | 旭日图占据 70% 视口高度，底部统计条固定 |
| 768-1023px | 旭日图占据 60% 视口高度 |
| < 768px | 旭日图占据全屏，统计条收起为小图标，点击展开 |

### 3.1.11 性能考虑

```typescript
// 首页旭日图数据接口
GET /v1/topics/overview

// 响应结构（轻量级，只返回可视化所需字段）
{
  topics: [
    {
      id: string,
      title: string,           // 截断到 50 字符
      status: 'active' | 'frozen' | 'archived',
      totalVotes: number,
      argumentCount: number,
      stanceDistribution: {
        pro: number,
        con: number,
        neutral: number
      },
      createdAt: string,
      lastActivityAt: string
    }
  ],
  stats: {
    totalTopics: number,
    totalArguments: number,
    totalVotes: number
  }
}
```

### 3.1.12 加载状态

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│                         ┌─────────────────┐                             │
│                         │                 │                             │
│                         │    ╭─────╮      │                             │
│                         │    │  ◐  │      │  ◄── 旋转加载动画          │
│                         │    ╰─────╯      │      (Ink 描边圆环)         │
│                         │                 │                             │
│                         │   加载议题中... │                             │
│                         │                 │                             │
│                         └─────────────────┘                             │
│                                                                         │
│                    (中心显示加载状态，旭日图逐步绘制)                     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

**加载动画**：扇区从中心向外逐个"生长"出来，而非一次性出现。

```css
@keyframes sector-grow {
  from {
    transform: scale(0);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

.sunburst-sector {
  animation: sector-grow 300ms ease-out forwards;
  animation-delay: calc(var(--sector-index) * 50ms);
}
```

---

## 3.2 Flow B：创建 Topic

### 3.2.1 表单布局

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│   ┌───────────────────────────────────────────────────────────────┐     │
│   │ CREATE NEW TOPIC                                              │     │
│   │ (Calling Card 标题，轻微旋转)                                  │     │
│   ├───────────────────────────────────────────────────────────────┤     │
│   │                                                               │     │
│   │  议题标题 *                                                    │     │
│   │  ┌─────────────────────────────────────────────────────────┐  │     │
│   │  │ 输入你的议题...                                          │  │     │
│   │  └─────────────────────────────────────────────────────────┘  │     │
│   │                                                               │     │
│   │  议题描述（根论点）*                                           │     │
│   │  ┌─────────────────────────────────────────────────────────┐  │     │
│   │  │                                                         │  │     │
│   │  │  (TipTap 富文本编辑器)                                   │  │     │
│   │  │                                                         │  │     │
│   │  │  支持：粗体、斜体、列表、引用、链接                        │  │     │
│   │  │                                                         │  │     │
│   │  └─────────────────────────────────────────────────────────┘  │     │
│   │                                                               │     │
│   │                              ┌────────────────────────────┐   │     │
│   │                              │   ▶ 发起议题              │   │     │
│   │                              │   (RebelRed + 打击动效)    │   │     │
│   │                              └────────────────────────────┘   │     │
│   │                                                               │     │
│   └───────────────────────────────────────────────────────────────┘     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2.2 创建成功后的 Owner 认领提示

创建成功后显示模态框，而非简单跳转：

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│   ┌───────────────────────────────────────────────────────────────┐     │
│   │ ✓ TOPIC CREATED                                               │     │
│   │ (Acid 背景 + Ink 边框，表示成功)                               │     │
│   ├───────────────────────────────────────────────────────────────┤     │
│   │                                                               │     │
│   │  你的议题已创建成功！                                          │     │
│   │                                                               │     │
│   │  ┌─────────────────────────────────────────────────────────┐  │     │
│   │  │ ! 成为 Host                                             │  │     │
│   │  │                                                         │  │     │
│   │  │ 你有 5 分钟 时间认领此议题的管理权限。                     │  │     │
│   │  │ 认领后你将可以：                                         │  │     │
│   │  │   • 编辑根论点文本                                       │  │     │
│   │  │   • 冻结/归档议题                                        │  │     │
│   │  │   • 修剪垃圾节点                                         │  │     │
│   │  │   • 生成共识报告                                         │  │     │
│   │  │                                                         │  │     │
│   │  │ 倒计时：04:32                                            │  │     │
│   │  └─────────────────────────────────────────────────────────┘  │     │
│   │                                                               │     │
│   │  [稍后再说]              [设置身份并认领 Host] (RebelRed)      │     │
│   │                                                               │     │
│   └───────────────────────────────────────────────────────────────┘     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 3.3 Flow C：Topic 详情（读路径）

### 3.3.1 Topic Header 设计

```
┌─────────────────────────────────────────────────────────────────────────┐
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                                                                 │    │
│  │  人工智能是否会取代人类工作？                        [active]   │    │
│  │  ─────────────────────────────────────────────────────────────  │    │
│  │                                                                 │    │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────────────┐  ┌───────────┐  │    │
│  │  │ ●●●●    │  │ ◆ 84   │  │ Host: 你        │  │ ⚙️ 管理  │  │    │
│  │  │ 你的身份 │  │ 余额    │  │ (仅 owner 可见) │  │           │  │    │
│  │  └─────────┘  └─────────┘  └─────────────────┘  └───────────┘  │    │
│  │                                                                 │    │
│  └─────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.3.2 ViewMode Tabs 设计

```
┌───────────────┬───────────────┬───────────────┐
│    FOCUS      │   OVERVIEW    │   GOD VIEW    │
│   (选中态)    │               │               │
│   Ink 填充    │   Paper 填充  │   Paper 填充  │
│   Paper 文字  │   Ink 文字    │   Ink 文字    │
└───────────────┴───────────────┴───────────────┘

选中态：
- 背景：var(--ink)
- 文字：var(--paper)
- 下方：RebelRed 3px 指示条

未选中态：
- 背景：var(--paper)
- 文字：var(--ink)
- 悬停：背景变为 var(--concrete-200)
```

### 3.3.3 Selected Node Card（右栏顶部）

当用户在左栏选中一个节点时，右栏顶部显示该节点的 Calling Card：

```
┌─────────────────────────────────────────────────────────────────────────┐
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │ ████████████████████████████████████████████████████████████████│◄── stance 色条 (4px)
│  ├─────────────────────────────────────────────────────────────────┤    │
│  │                                                                 │    │
│  │  "人工智能将在未来十年内取代大多数重复性工作，                    │    │
│  │   但创造性工作仍需要人类..."                                     │    │
│  │                                                                 │    │
│  │  ─────────────────────────────────────────────────────────────  │    │
│  │                                                                 │    │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────────────┐ │    │
│  │  │ PRO      │  │ ●89 票   │  │ a7f3...  │  │ AI: ████░░ 80%  │ │    │
│  │  │ (stance) │  │ (votes)  │  │ (author) │  │ (analysis状态)  │ │    │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────────────┘ │    │
│  │                                                                 │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│      ↑                                                                  │
│      轻微旋转 (-1deg) + 双层阴影 (RebelRed + Ink)                        │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.3.4 Children List（右栏中部）

```
┌─────────────────────────────────────────────────────────────────────────┐
│  ┌─────────────────────┬─────────────────────┐                          │
│  │      最热 (24)      │      最新 (24)      │  ◄── 子 tabs            │
│  └─────────────────────┴─────────────────────┘                          │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │ ██│ "但是，很多工作需要情感智能，这是 AI 无法替代的..."          │    │
│  │   │  ●42  a3b2...  CON                                         │    │
│  └───┴─────────────────────────────────────────────────────────────┘    │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │ ██│ "历史上每次技术革命都创造了更多工作机会..."                   │    │
│  │   │  ●38  c4d5...  PRO                                         │    │
│  └───┴─────────────────────────────────────────────────────────────┘    │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │ ██│ "我们需要讨论的是转型期的社会保障问题..."                    │    │
│  │   │  ●27  e6f7...  NEUTRAL                                     │    │
│  └───┴─────────────────────────────────────────────────────────────┘    │
│                                                                         │
│  ↑                                                                      │
│  左侧 stance 色条 (4px)：Electric(pro) / RebelRed(con) / Acid(neutral)  │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 3.4 Flow D：发言与投票（仪式感交互）

这是产品最核心的交互，需要设计**仪式感**。

### 3.4.1 Reply + Vote Deck（右栏底部固定）

```
┌─────────────────────────────────────────────────────────────────────────┐
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │ REPLY TO: "人工智能将在未来十年内..."                           │    │
│  │ (Calling Card 标题)                                             │    │
│  ├─────────────────────────────────────────────────────────────────┤    │
│  │                                                                 │    │
│  │  ┌───────────────────────────────────────────────────────────┐  │    │
│  │  │ B  I  U  " | • ─ ─ │ 🔗                                   │  │    │
│  │  ├───────────────────────────────────────────────────────────┤  │    │
│  │  │                                                           │  │    │
│  │  │  (TipTap 富文本编辑器)                                     │  │    │
│  │  │                                                           │  │    │
│  │  │  输入你的观点...                                           │  │    │
│  │  │                                                           │  │    │
│  │  └───────────────────────────────────────────────────────────┘  │    │
│  │                                                                 │    │
│  │  ─────────────────────────────────────────────────────────────  │    │
│  │                                                                 │    │
│  │  为当前节点投票                                                 │    │
│  │                                                                 │    │
│  │  ┌───────────────────────────────────────────────────────────┐  │    │
│  │  │              P5Slider (投票滑块)                           │  │    │
│  │  │                                                           │  │    │
│  │  │  0 ─────────●─────────────────────────────────────── 10   │  │    │
│  │  │            ▲                                              │  │    │
│  │  │            4 票                                           │  │    │
│  │  │                                                           │  │    │
│  │  │  ┌─────────────────┐  ┌─────────────────────────────────┐ │  │    │
│  │  │  │  花费: 16 分    │  │  余额: 84 → 68 分              │ │  │    │
│  │  │  │  (Mono 字体)    │  │  (实时计算)                     │ │  │    │
│  │  │  └─────────────────┘  └─────────────────────────────────┘ │  │    │
│  │  └───────────────────────────────────────────────────────────┘  │    │
│  │                                                                 │    │
│  │                                        ┌────────────────────┐   │    │
│  │                                        │  ▶ 提交回复        │   │    │
│  │                                        │  (RebelRed)        │   │    │
│  │                                        └────────────────────┘   │    │
│  │                                                                 │    │
│  └─────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.4.2 P5Slider 组件规格（投票核心）

这是最重要的自定义组件，需要完整设计：

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│   投票数                                                                │
│                                                                         │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  0    1    2    3    4    5    6    7    8    9    10          │   │
│   │  ├────┼────┼────┼────┼────┼────┼────┼────┼────┼────┤          │   │
│   │  ═════════════════●═══════════════════════════════════          │   │
│   │                   ▲                                              │   │
│   │              ┌────┴────┐                                         │   │
│   │              │    4    │ ◄── 当前值气泡                          │   │
│   │              └─────────┘                                         │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│   ┌──────────────────────────┐    ┌──────────────────────────────────┐  │
│   │  花费                    │    │  变化                            │  │
│   │  ┌────────────────────┐  │    │  ┌────────────────────────────┐  │  │
│   │  │      16 分         │  │    │  │  当前: 1票 (1分)           │  │  │
│   │  │   (cost = 4²)      │  │    │  │  目标: 4票 (16分)          │  │  │
│   │  └────────────────────┘  │    │  │  ─────────────────────────  │  │  │
│   │                          │    │  │  Δ = +15 分                │  │  │
│   └──────────────────────────┘    └──────────────────────────────────┘  │
│                                                                         │
│   余额预览                                                              │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  ◆ 84  ────────────────────────────────▶  ◆ 69                 │   │
│   │   当前                                      操作后               │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

#### P5Slider 视觉规格

```css
.p5-slider {
  /* 轨道 */
  --track-height: 8px;
  --track-bg: var(--concrete-200);
  --track-border: 3px solid var(--ink);
  --track-fill: var(--rebel-red);  /* 已填充部分 */

  /* 滑块 */
  --thumb-size: 24px;
  --thumb-bg: var(--paper);
  --thumb-border: 4px solid var(--ink);
  --thumb-shadow: 2px 2px 0 var(--ink);

  /* 刻度 */
  --tick-color: var(--ink);
  --tick-height: 12px;
}

/* 滑块悬停 */
.p5-slider:hover .thumb {
  transform: scale(1.1);
  box-shadow: 3px 3px 0 var(--rebel-red), 5px 5px 0 var(--ink);
}

/* 滑块拖动中 */
.p5-slider:active .thumb {
  transform: scale(0.95);
  box-shadow: 1px 1px 0 var(--ink);
}
```

#### 数值气泡（跟随滑块）

```css
.slider-value-bubble {
  position: absolute;
  background: var(--ink);
  color: var(--paper);
  padding: 4px 8px;
  font-family: var(--font-mono);
  font-size: 14px;
  border: 2px solid var(--paper);

  /* 三角指向 */
  &::after {
    content: '';
    position: absolute;
    bottom: -8px;
    left: 50%;
    border: 4px solid transparent;
    border-top-color: var(--ink);
  }
}
```

### 3.4.3 投票确认动效（仪式感）

当用户点击"提交"时，触发**印刷打击**动效：

```
1. 按钮下压 (50ms)
   transform: translate(2px, 2px)
   box-shadow: 归零

2. 全屏闪烁 (100ms)
   overlay: var(--rebel-red) opacity 0.1

3. 成功印章 (200ms)
   中心出现 "✓ VOTED" 印章图标
   scale: 0 → 1.2 → 1
   rotate: -10deg → 0deg

4. 数值更新 (150ms)
   余额数字：旧值 → 新值（数字滚动动画）
   节点票数：+N 飞入动画
```

### 3.4.4 余额不足时的警告（402 错误）

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │ ████████████████████████████████████████████████████████████████│    │
│  │ █                                                              █│    │
│  │ █  ⚠ 余额不足                                                  █│    │
│  │ █                                                              █│    │
│  │ █  当前余额: ◆ 12                                              █│    │
│  │ █  需要花费: ◆ 25 (5² = 25)                                    █│    │
│  │ █  差额: ◆ 13                                                  █│    │
│  │ █                                                              █│    │
│  │ █  你需要先撤回其他节点的投票来释放积分                          █│    │
│  │ █                                                              █│    │
│  │ █  ┌──────────────────────────────────────────────────────┐   █│    │
│  │ █  │  ▶ 前往「我的」管理投票  │  [关闭]                    │   █│    │
│  │ █  └──────────────────────────────────────────────────────┘   █│    │
│  │ █                                                              █│    │
│  │ ████████████████████████████████████████████████████████████████│    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                         │
│  ↑ RebelRed 边框 (6px) + shake 动画                                     │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 3.5 Flow E：Owner 管理（Host Deck）

### 3.5.1 管理面板入口

仅当 `topic.ownerPubkey === identityPubkey` 时，在 Topic Header 显示 ⚙️ 图标。

点击后展开管理面板（侧边抽屉或模态框）：

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │ HOST CONTROL DECK                                               │    │
│  │ (RebelRed 标题条)                                                │    │
│  ├─────────────────────────────────────────────────────────────────┤    │
│  │                                                                 │    │
│  │  议题状态                                                        │    │
│  │  ┌─────────────────────────────────────────────────────────┐    │    │
│  │  │ ○ Active (当前)                                         │    │    │
│  │  │ ○ Frozen (只读，允许撤回)                                │    │    │
│  │  │ ○ Archived (完全只读)                                   │    │    │
│  │  └─────────────────────────────────────────────────────────┘    │    │
│  │                                                                 │    │
│  │  ─────────────────────────────────────────────────────────────  │    │
│  │                                                                 │    │
│  │  快捷操作                                                        │    │
│  │                                                                 │    │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │    │
│  │  │ 编辑根论点      │  │ 生成共识报告    │  │ 查看被修剪节点  │  │    │
│  │  │ (Ink Button)    │  │ (Ink Button)    │  │ (Ink Button)    │  │    │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘  │    │
│  │                                                                 │    │
│  │  ─────────────────────────────────────────────────────────────  │    │
│  │                                                                 │    │
│  │  危险操作（需二次确认）                                          │    │
│  │                                                                 │    │
│  │  ┌─────────────────────────────────────────────────────────┐    │    │
│  │  │  ⚠ 修剪选中节点                    [执行] (Danger)      │    │    │
│  │  │  将节点标记为垃圾，从视图隐藏                            │    │    │
│  │  └─────────────────────────────────────────────────────────┘    │    │
│  │                                                                 │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.5.2 破坏性操作确认弹窗

所有破坏性操作（freeze/archive/prune）必须显示 P5 风格的确认弹窗：

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│         ┌───────────────────────────────────────────────────┐           │
│         │▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓│           │
│         │▓                                                 ▓│           │
│         │▓  ⚠ 确认修剪节点？                               ▓│           │
│         │▓                                                 ▓│           │
│         │▓  此操作将：                                     ▓│           │
│         │▓  • 从所有视图隐藏该节点及其子节点                ▓│           │
│         │▓  • 该节点上的投票不会自动退还                   ▓│           │
│         │▓  • 用户仍可手动撤回投票                         ▓│           │
│         │▓                                                 ▓│           │
│         │▓  输入 "PRUNE" 以确认：                          ▓│           │
│         │▓  ┌─────────────────────────────────────────┐   ▓│           │
│         │▓  │                                         │   ▓│           │
│         │▓  └─────────────────────────────────────────┘   ▓│           │
│         │▓                                                 ▓│           │
│         │▓  [取消]                        [确认修剪]       ▓│           │
│         │▓                                (Danger Red)     ▓│           │
│         │▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓│           │
│         └───────────────────────────────────────────────────┘           │
│                                                                         │
│  ↑ 6px RebelRed 边框 + 红色斜线纹理背景 + shake 动画                     │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 3.6 Flow F：My Activity

### 3.6.1 页面布局

```
┌─────────────────────────────────────────────────────────────────────────┐
│                            TopBar                                       │
├────────────────────────────────────┬────────────────────────────────────┤
│                                    │                                    │
│         VISITED TOPICS             │         SELECTED TOPIC             │
│         已访问的议题                │         投票详情                    │
│                                    │                                    │
│  ┌──────────────────────────────┐  │  ┌──────────────────────────────┐  │
│  │ ▶ 人工智能是否会取代...      │  │  │ 议题: 人工智能是否会取代...  │  │
│  │   余额: ◆ 84                 │  │  │                              │  │
│  │   最后访问: 2h ago           │  │  │ 总投入: ◆ 16                 │  │
│  └──────────────────────────────┘  │  │ 当前余额: ◆ 84               │  │
│                                    │  │                              │  │
│  ┌──────────────────────────────┐  │  │ ─────────────────────────── │  │
│  │ ▶ 加密货币应该被监管吗？      │  │  │                              │  │
│  │   余额: ◆ 100 (未投票)       │  │  │ 我的投票:                    │  │
│  │   最后访问: 1d ago           │  │  │                              │  │
│  └──────────────────────────────┘  │  │ ┌──────────────────────────┐ │  │
│                                    │  │ │ "AI将取代..." (4票/16分) │ │  │
│  ┌──────────────────────────────┐  │  │ │ [撤回]                   │ │  │
│  │ ▶ 远程工作是否应该成为...    │  │  │ └──────────────────────────┘ │  │
│  │   余额: ◆ 67                 │  │  │                              │  │
│  │   最后访问: 3d ago           │  │  │ ┌──────────────────────────┐ │  │
│  └──────────────────────────────┘  │  │ │ "历史上每次..." (2票/4分)│ │  │
│                                    │  │ │ [PRUNED] [撤回]          │ │  │
│                                    │  │ └──────────────────────────┘ │  │
│                                    │  │                              │  │
│                                    │  │ ─────────────────────────── │  │
│  ─────────────────────────────────  │  │                              │  │
│                                    │  │ ┌──────────────────────────┐ │  │
│  身份管理                           │  │ │  ▶ 一键撤回全部          │ │  │
│  ┌──────────────────────────────┐  │  │ │  (RebelRed)              │ │  │
│  │ 当前身份: ●●●● a7f3...       │  │  │ └──────────────────────────┘ │  │
│  │                              │  │  │                              │  │
│  │ [备份助记词] [导入身份]       │  │  │ 撤回进度: ████████░░ 80%    │  │
│  └──────────────────────────────┘  │  │ 成功: 4/5  失败: 1          │  │
│                                    │  │                              │  │
│                                    │  │ [重试失败项]                 │  │
│                                    │  └──────────────────────────────┘  │
│                                    │                                    │
└────────────────────────────────────┴────────────────────────────────────┘
```

### 3.6.2 一键撤回进度反馈

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│  撤回进度                                                               │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │ ████████████████████████████████████░░░░░░░░░░░░░░░░░░░░░░░░░░ │    │
│  │                         60%                                     │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                         │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐       │
│  │ ✓ 成功: 3        │  │ ⏳ 进行中: 1     │  │ ✗ 失败: 1        │       │
│  │ (Acid 背景)      │  │ (Electric 背景)  │  │ (RebelRed 背景)  │       │
│  └──────────────────┘  └──────────────────┘  └──────────────────┘       │
│                                                                         │
│  失败详情:                                                              │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │ ✗ "历史上每次..." - 网络错误，请重试                            │    │
│  │   [重试此项]                                                    │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

# 第四部分：身份系统 UX

## 4.1 身份机制概述

> **核心理念**：身份静默创建，用户无感知；备份/恢复是可选的高级操作。

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│   首次访问任意页面                                                       │
│         │                                                               │
│         ▼                                                               │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │               静默生成 Master Seed                              │   │
│   │               ════════════════════════                          │   │
│   │               • 自动生成 BIP39 助记词                            │   │
│   │               • 存入 IndexedDB / LocalStorage                   │   │
│   │               • 用户完全无感知                                   │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│         │                                                               │
│         ▼                                                               │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │               正常使用                                          │   │
│   │               ─────────                                         │   │
│   │               • 进入 Topic 时自动派生影子身份                     │   │
│   │               • 发言/投票自动签名                                │   │
│   │               • TopBar 显示指纹图标（如 ●●●●）                   │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│         │                                                               │
│         ▼                                                               │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │               /my 页面 - 可选备份                                │   │
│   │               ─────────────────────                              │   │
│   │               • 助记词默认遮罩显示                               │   │
│   │               • 点击 👁 图标揭示                                 │   │
│   │               • 提供复制按钮                                     │   │
│   │               • 提供导入入口（恢复/同步设备）                     │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

## 4.2 /my 页面身份区域设计

### 4.2.1 布局

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│  身份管理                                                               │
│  ════════                                                               │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                                                                 │    │
│  │  当前身份                                                       │    │
│  │  ┌───────────────────────────────────────────────────────────┐  │    │
│  │  │ ●●●● a7f3b2c1...d4e5                                      │  │    │
│  │  │ (指纹图标 + 地址截断)                                       │  │    │
│  │  └───────────────────────────────────────────────────────────┘  │    │
│  │                                                                 │    │
│  │  ─────────────────────────────────────────────────────────────  │    │
│  │                                                                 │    │
│  │  助记词备份                                                     │    │
│  │  ┌───────────────────────────────────────────────────────────┐  │    │
│  │  │                                                           │  │    │
│  │  │  •••• •••• •••• •••• •••• ••••                            │  │    │
│  │  │  •••• •••• •••• •••• •••• ••••              [👁] [复制]   │  │    │
│  │  │                                                           │  │    │
│  │  │  (默认遮罩状态，12 个词显示为圆点)                          │  │    │
│  │  │                                                           │  │    │
│  │  └───────────────────────────────────────────────────────────┘  │    │
│  │                                                                 │    │
│  │  ┌─────────────────────────────────────────────────────────┐    │    │
│  │  │ ⚠ 助记词是恢复身份的唯一方式                             │    │    │
│  │  │   清除浏览器数据或更换设备后，未备份将永久丢失            │    │    │
│  │  └─────────────────────────────────────────────────────────┘    │    │
│  │                                                                 │    │
│  │  ─────────────────────────────────────────────────────────────  │    │
│  │                                                                 │    │
│  │  [导入已有身份]                                                 │    │
│  │  (用于跨设备同步或恢复)                                         │    │
│  │                                                                 │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.2.2 助记词揭示交互

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│  点击 👁 按钮后                                                         │
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                                                                   │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │                                                             │  │  │
│  │  │   1. apple      2. banana     3. cherry     4. dragon       │  │  │
│  │  │   5. elephant   6. forest     7. guitar     8. heaven       │  │  │
│  │  │   9. island    10. jungle    11. kitchen   12. lemon        │  │  │
│  │  │                                                             │  │  │
│  │  │   (Mono 字体，Ink 背景 + Paper 文字，P5 风格卡片)            │  │  │
│  │  │                                                             │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  │                                                       [🙈] [复制] │  │
│  │                                                                   │  │
│  │  自动隐藏：30 秒后自动恢复遮罩状态                                 │  │
│  │                                                                   │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                         │
│  视觉规格:                                                              │
│  - 遮罩态: var(--concrete-200) 背景 + 圆点占位                          │
│  - 揭示态: var(--ink) 背景 + var(--paper) 文字                          │
│  - 边框: 4px solid var(--ink)                                          │
│  - 揭示动画: 从遮罩到明文的翻转效果 (150ms)                              │
│  - 👁 → 🙈 图标切换                                                    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.2.3 复制交互

```
点击 [复制] 按钮:
1. 助记词复制到剪贴板
2. 按钮文字变为 "✓ 已复制" (Acid 背景)
3. 2 秒后恢复为 [复制]
4. 30 秒后自动清除剪贴板（安全考虑）
```

### 4.2.4 导入身份 Modal

点击「导入已有身份」后弹出：

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │ IMPORT IDENTITY                                                 │    │
│  │ (Ink 标题栏)                                                     │    │
│  ├─────────────────────────────────────────────────────────────────┤    │
│  │                                                                 │    │
│  │  输入 12 个助记词（用空格分隔）：                                 │    │
│  │                                                                 │    │
│  │  ┌─────────────────────────────────────────────────────────┐    │    │
│  │  │                                                         │    │    │
│  │  │  (P5Textarea - 4px Ink 边框)                            │    │    │
│  │  │                                                         │    │    │
│  │  └─────────────────────────────────────────────────────────┘    │    │
│  │                                                                 │    │
│  │  验证状态:                                                      │    │
│  │  ┌─────────────────────────────────────────────────────────┐    │    │
│  │  │ ✓ 格式正确 (12 个词)                                    │    │    │
│  │  │ ✓ 校验和有效                                            │    │    │
│  │  │ 派生地址: a7f3...                                       │    │    │
│  │  └─────────────────────────────────────────────────────────┘    │    │
│  │                                                                 │    │
│  │  ┌─────────────────────────────────────────────────────────┐    │    │
│  │  │ ⚠ 导入将覆盖当前设备上的身份                             │    │    │
│  │  │   当前身份的投票记录将无法访问（除非再次导入）            │    │    │
│  │  └─────────────────────────────────────────────────────────┘    │    │
│  │                                                                 │    │
│  │  [取消]                                    [导入身份] (RebelRed) │    │
│  │                                                                 │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

## 4.3 TopBar 身份指示器

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│  TopBar 右侧身份区域                                                     │
│                                                                         │
│  ┌──────────────────┐                                                   │
│  │ ●●●● a7f3...     │  ◄── 点击跳转 /my 页面                           │
│  └──────────────────┘                                                   │
│                                                                         │
│  指纹图标说明:                                                           │
│  - 4 个圆点是 pubkey 前 4 字节的视觉哈希                                 │
│  - 颜色从 pubkey 派生（确保不同身份视觉可区分）                           │
│  - Hover: 显示完整地址 tooltip                                          │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

# 第五部分：共识报告 UX

## 5.1 报告生成流程

```
Host 点击"生成共识报告"
        │
        ▼
┌─────────────────┐
│ 确认弹窗        │
│ "这可能需要1-2分钟" │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 生成中状态      │
│ (Loading Modal) │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 报告展示        │
│ (Full-screen)   │
└─────────────────┘
```

## 5.2 生成中状态

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │ GENERATING CONSENSUS REPORT                                     │    │
│  │ (Electric 边框 - 表示进行中)                                     │    │
│  ├─────────────────────────────────────────────────────────────────┤    │
│  │                                                                 │    │
│  │                      ┌─────────────┐                            │    │
│  │                      │    ◐        │                            │    │
│  │                      │  (旋转动画) │                            │    │
│  │                      └─────────────┘                            │    │
│  │                                                                 │    │
│  │                    AI 正在分析讨论内容...                        │    │
│  │                                                                 │    │
│  │  ┌─────────────────────────────────────────────────────────┐    │    │
│  │  │ ✓ 收集论点数据                                          │    │    │
│  │  │ ✓ 识别主要阵营                                          │    │    │
│  │  │ ⏳ 生成草案报告...                                       │    │    │
│  │  │ ○ 模拟双边批评                                          │    │    │
│  │  │ ○ 递归修订                                              │    │    │
│  │  └─────────────────────────────────────────────────────────┘    │    │
│  │                                                                 │    │
│  │  预计剩余时间: ~45 秒                                           │    │
│  │                                                                 │    │
│  │                               [取消]                            │    │
│  │                                                                 │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

## 5.3 报告展示（全屏模态）

```
┌─────────────────────────────────────────────────────────────────────────┐
│ ████████████████████████████████████████████████████████████████████████│
│ █                                                                     █│
│ █  CONSENSUS REPORT                                           [✕]    █│
│ █  人工智能是否会取代人类工作？                                        █│
│ █  生成时间: 2024-01-15 14:32                                         █│
│ █                                                                     █│
│ ████████████████████████████████████████████████████████████████████████│
│                                                                         │
│  ┌──────────────────────────────┐  ┌──────────────────────────────────┐ │
│  │ CAMP A: 技术乐观派           │  │ CAMP B: 社会担忧派               │ │
│  │ (Electric 边框)              │  │ (RebelRed 边框)                  │ │
│  ├──────────────────────────────┤  ├──────────────────────────────────┤ │
│  │                              │  │                                  │ │
│  │ 核心主张:                    │  │ 核心主张:                        │ │
│  │ "技术进步总是创造更多        │  │ "这次不同，AI的能力范围          │ │
│  │  就业机会，历史已经证明"      │  │  前所未有，覆盖认知领域"          │ │
│  │                              │  │                                  │ │
│  │ 代表论点:                    │  │ 代表论点:                        │ │
│  │ • 工业革命创造了...          │  │ • 白领工作首当其冲...            │ │
│  │ • 新技术带来新职业...        │  │ • 转型期的社会成本...            │ │
│  │                              │  │                                  │ │
│  │ 参与者: 23                   │  │ 参与者: 31                       │ │
│  │ 总票数: 342                  │  │ 总票数: 456                      │ │
│  └──────────────────────────────┘  └──────────────────────────────────┘ │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │ BRIDGE STATEMENT (共识桥梁)                                     │    │
│  │ (Acid 边框)                                                     │    │
│  ├─────────────────────────────────────────────────────────────────┤    │
│  │                                                                 │    │
│  │ 双方在以下方面存在共识：                                         │    │
│  │                                                                 │    │
│  │ 1. AI 确实会改变劳动力市场结构                                   │    │
│  │ 2. 教育和培训体系需要适应性改革                                  │    │
│  │ 3. 社会保障网络在转型期尤为重要                                  │    │
│  │                                                                 │    │
│  │ 主要分歧在于：                                                   │    │
│  │                                                                 │    │
│  │ • 转型的速度和规模（乐观派认为渐进，担忧派认为剧烈）              │    │
│  │ • 政策干预的必要性和时机                                         │    │
│  │                                                                 │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                         │
│  [复制报告]  [导出 PDF]                                    [关闭]       │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

# 第六部分：可视化规范

## 6.1 FocusView（树形视图）

### 6.1.1 布局规则

- **方向**: 自上而下 (Top-Down)
- **连接线**: 直角折线 (Orthogonal Lines)，**严禁曲线**
- **披露**: 渐进式 (Progressive Disclosure)，点击展开子节点

### 6.1.2 节点设计

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │██│ "人工智能将在未来十年内取代大多数重复性工作..."              │    │
│  │  │                                                              │    │
│  │  │  ┌─────────┐  ┌─────────┐  ┌─────────┐                      │    │
│  │  │  │ ●89     │  │ PRO     │  │ ▼ 12    │                      │    │
│  │  │  │ (votes) │  │ (stance)│  │ (子节点) │                      │    │
│  │  │  └─────────┘  └─────────┘  └─────────┘                      │    │
│  └──┴──────────────────────────────────────────────────────────────┘    │
│     ↑                                                                   │
│     stance 色条 (4px): Electric / RebelRed / Acid                       │
│                                                                         │
│  选中态:                                                                │
│  - 双层阴影: RebelRed (4px 4px) + Ink (8px 8px)                         │
│  - 边框加粗: 5px                                                        │
│  - 轻微放大: scale(1.02)                                                │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 6.1.3 连接线样式

```css
.focus-connection-line {
  stroke: var(--ink);
  stroke-width: 3px;
  stroke-linecap: square;  /* 直角端点 */
  fill: none;
}

/* 高亮路径（从根到选中节点）*/
.focus-connection-line.highlighted {
  stroke: var(--rebel-red);
  stroke-width: 4px;
}
```

### 6.1.4 展开/收起动画

```css
/* 子树展开 */
@keyframes focus-expand {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.focus-subtree-enter {
  animation: focus-expand 200ms ease-out;
}
```

---

## 6.2 GodView（语义地图）

### 6.2.1 Canvas 结构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                                                                 │    │
│  │      ┌───────────────────┐                                      │    │
│  │      │  Camp A: 技术派   │  ◄── 集群标签 (Calling Card 风格)    │    │
│  │      │  (半透明 Electric │                                      │    │
│  │      │   + Ink 虚线边)   │      ●  ●                            │    │
│  │      │     ●  ●          │        ●                             │    │
│  │      │   ●      ●        │                                      │    │
│  │      │      ●            │                                      │    │
│  │      └───────────────────┘                                      │    │
│  │                                                                 │    │
│  │                          ┌───────────────────┐                  │    │
│  │                          │  Camp B: 担忧派   │                  │    │
│  │                          │  (半透明 RebelRed │                  │    │
│  │           ●              │   + Ink 虚线边)   │                  │    │
│  │         ●   ●            │     ●  ●          │                  │    │
│  │                          │   ●      ●        │                  │    │
│  │                          │      ●            │                  │    │
│  │                          └───────────────────┘                  │    │
│  │                                                                 │    │
│  │  ┌─────────────────────────────────────────────────────────┐    │    │
│  │  │ Legend                                                   │    │    │
│  │  │ ● Pro (Electric)  ● Con (RebelRed)  ● Neutral (Acid)    │    │    │
│  │  │ 点大小 = 总票数    虚线圈 = 语义聚类                      │    │    │
│  │  └─────────────────────────────────────────────────────────┘    │    │
│  │                                                                 │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 6.2.2 节点渲染规格

```javascript
// 节点绘制参数
const nodeConfig = {
  // 基础
  baseFill: '#FFFFFF',
  strokeWidth: 3,

  // 大小映射 (votes → radius)
  minRadius: 8,
  maxRadius: 32,
  radiusScale: d3.scaleSqrt().domain([0, maxVotes]).range([8, 32]),

  // 立场色描边
  stanceColors: {
    pro: '#2563EB',     // Electric
    con: '#FF0033',     // RebelRed
    neutral: '#FACC15'  // Acid
  },

  // 选中态
  selectedStrokeWidth: 5,
  selectedShadow: '0 0 0 4px var(--rebel-red), 0 0 0 8px var(--ink)'
}
```

### 6.2.3 集群区域

```javascript
// 集群背景
const clusterConfig = {
  fillOpacity: 0.1,
  strokeStyle: 'dashed',
  strokeDasharray: '8 4',
  strokeWidth: 2,
  strokeColor: '#1A1A1D',  // Ink

  // 标签样式 (Calling Card)
  labelBg: '#1A1A1D',
  labelColor: '#FFFFFF',
  labelPadding: '4px 8px',
  labelRotation: -2  // 轻微旋转
}
```

### 6.2.4 Hover Calling Card

当鼠标悬停在节点上时，显示 Calling Card tooltip：

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│      ┌───────────────────────────────────────────────────┐              │
│      │██████████████████████████████████████████████████│◄── stance 色条│
│      ├───────────────────────────────────────────────────┤              │
│      │                                                   │              │
│      │  "人工智能将在未来十年内取代大多数                 │              │
│      │   重复性工作，但创造性工作仍需..."                 │◄── 前40字    │
│      │                                                   │              │
│      │  ┌─────────┐  ┌─────────┐  ┌─────────┐           │              │
│      │  │ a7f3... │  │ ●89     │  │ PRO     │           │              │
│      │  │ (作者)  │  │ (票数)  │  │ (立场)  │           │              │
│      │  └─────────┘  └─────────┘  └─────────┘           │              │
│      │                                                   │              │
│      └───────────────────────────────────────────────────┘              │
│          ↑                                                              │
│          skew-x: -3deg, rotate: -0.6deg                                 │
│          shadow: 4px 4px RebelRed, 8px 8px Ink                          │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 6.3 SunburstView（旭日图）

### 6.3.1 SVG 结构

- 扇形用 stance 色填充
- 所有扇形有 Ink 描边 (2px)
- 选中扇形有双层描边 (RebelRed + Ink)

### 6.3.2 交互规格

| 状态 | 视觉效果 |
|-----|---------|
| 默认 | stance 色填充 + 2px Ink 描边 |
| 悬停 | 填充色加深 10% + 显示 Calling Card tooltip |
| 选中 | 4px RebelRed 描边 + 8px Ink 描边 + 贴纸标签 |

### 6.3.3 选中态贴纸标签

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│                    选中的扇形区域                                        │
│                         │                                               │
│                         ▼                                               │
│                    ┌─────────┐                                          │
│                    │ PRO ●42 │  ◄── 贴纸标签                            │
│                    │ a7f3... │      Ink 背景 + Paper 文字               │
│                    └─────────┘      轻微旋转 (-2deg)                    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

# 第七部分：TipTap 富文本编辑器 UX

## 7.1 工具栏设计

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │ B   I   U   S │ H1  H2  H3 │ •   1.  " │ 🔗  ⌫                 │    │
│  │ ─   ─   ─   ─   ─   ─   ─    ─   ─   ─   ─   ─                 │    │
│  │                                                                 │    │
│  │ 粗体 斜体 下划 删除 标题1-3   列表 有序 引用 链接 清除格式        │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                         │
│  工具栏规格:                                                            │
│  - 背景: var(--concrete-200)                                           │
│  - 边框: 3px solid var(--ink) (仅底边)                                 │
│  - 按钮: 32x32px, Ink 图标                                             │
│  - 激活态: Ink 背景 + Paper 图标                                        │
│  - 悬停态: RebelRed 下划线                                              │
│  - 分组: 用 2px Ink 垂直线分隔                                          │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

## 7.2 编辑区域

```css
.tiptap-editor {
  /* 容器 */
  border: 4px solid var(--ink);
  background: var(--paper);
  min-height: 120px;
  padding: 16px;

  /* 聚焦态 */
  &:focus-within {
    box-shadow: 4px 4px 0 var(--rebel-red), 8px 8px 0 var(--ink);
  }

  /* 占位符 */
  .placeholder {
    color: var(--concrete-100);
    font-style: italic;
  }
}
```

## 7.3 渲染样式

富文本在 Calling Card / 详情页中渲染时的样式：

```css
.tiptap-render {
  /* 段落 */
  p {
    margin-bottom: 0.75em;
    line-height: 1.6;
  }

  /* 标题 */
  h1, h2, h3 {
    font-family: var(--font-display);
    text-transform: uppercase;
    margin: 1em 0 0.5em;
  }

  /* 引用 */
  blockquote {
    border-left: 4px solid var(--rebel-red);
    padding-left: 16px;
    margin: 1em 0;
    font-style: italic;
    background: var(--concrete-200);
  }

  /* 列表 */
  ul { list-style: none; }
  ul li::before {
    content: '▶';
    color: var(--rebel-red);
    margin-right: 8px;
  }

  /* 链接 */
  a {
    color: var(--electric);
    text-decoration: underline;
    text-decoration-thickness: 2px;
  }
}
```

## 7.4 允许的格式（安全白名单）

| 格式 | TipTap Extension | 说明 |
|-----|------------------|------|
| 段落 | Paragraph | 默认 |
| 粗体 | Bold | `**text**` |
| 斜体 | Italic | `*text*` |
| 下划线 | Underline | - |
| 删除线 | Strike | `~~text~~` |
| 标题 | Heading (1-3) | `#` `##` `###` |
| 无序列表 | BulletList | `- item` |
| 有序列表 | OrderedList | `1. item` |
| 引用 | Blockquote | `> quote` |
| 链接 | Link | 需 href 白名单 + `rel=noopener` |

**禁止**: 图片、视频、iframe、任意 HTML

---

# 第八部分：组件规格详解

## 8.1 P5Button

### 变体

| 变体 | 背景 | 文字 | 边框 | 阴影 | 用途 |
|-----|------|------|------|------|------|
| `primary` | RebelRed | Paper | 4px Ink | 4px 4px Ink | 主 CTA |
| `ink` | Ink | Paper | 4px Ink | 4px 4px RebelRed | 次要操作 |
| `ghost` | transparent | Ink | 4px Ink | none | 低优先级 |
| `danger` | Paper | RebelRed | 4px RebelRed | 4px 4px Ink | 破坏性操作 |

### 状态

```css
.p5-button {
  /* 基础 */
  padding: 12px 24px;
  font-family: var(--font-display);
  font-size: 16px;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  cursor: pointer;
  transition: transform 80ms, box-shadow 80ms;

  /* 悬停 */
  &:hover:not(:disabled) {
    transform: translate(-2px, -2px);
    /* shadow offset 增加 2px */
  }

  /* 按下 */
  &:active:not(:disabled) {
    transform: translate(2px, 2px);
    box-shadow: none;
  }

  /* 聚焦 */
  &:focus-visible {
    outline: 3px solid var(--rebel-red);
    outline-offset: 2px;
  }

  /* 禁用 */
  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
}
```

---

## 8.2 P5Card / P5Panel

### P5Card（紧凑卡片）

```css
.p5-card {
  background: var(--paper);
  border: 4px solid var(--ink);
  box-shadow: 4px 4px 0 var(--ink);

  /* 斜切角 */
  clip-path: polygon(
    0 0,
    100% 0,
    100% calc(100% - 12px),
    calc(100% - 12px) 100%,
    0 100%
  );

  /* 标题栏（可选）*/
  .card-header {
    background: var(--ink);
    color: var(--paper);
    padding: 8px 16px;
    font-family: var(--font-display);
    text-transform: uppercase;
  }

  .card-body {
    padding: 16px;
  }
}
```

### P5Panel（大面板）

```css
.p5-panel {
  background: var(--paper);
  border: 4px solid var(--ink);
  box-shadow: 6px 6px 0 var(--ink);

  /* 轻微旋转（可选）*/
  transform: rotate(-0.3deg);

  .panel-header {
    background: var(--ink);
    color: var(--paper);
    padding: 12px 20px;
    font-family: var(--font-display);
    font-size: 20px;
    text-transform: uppercase;

    /* Calling Card 风格旋转 */
    transform: rotate(0.5deg);
    margin: -4px -4px 0 -4px;
  }
}
```

---

## 8.3 P5Modal

### 结构

```
┌─────────────────────────────────────────────────────────────────────────┐
│  (半透明黑色遮罩 rgba(0,0,0,0.6))                                        │
│                                                                         │
│         ┌───────────────────────────────────────────────────┐           │
│         │ MODAL TITLE                              [✕]      │           │
│         │ (Ink 背景 + Paper 文字)                            │           │
│         ├───────────────────────────────────────────────────┤           │
│         │                                                   │           │
│         │  Modal 内容区域                                    │           │
│         │                                                   │           │
│         │  (padding: 24px)                                  │           │
│         │                                                   │           │
│         ├───────────────────────────────────────────────────┤           │
│         │                                                   │           │
│         │  [取消]                      [确认] (primary)     │           │
│         │                                                   │           │
│         └───────────────────────────────────────────────────┘           │
│                                                                         │
│  Modal 规格:                                                            │
│  - 边框: 6px solid var(--ink)                                          │
│  - 阴影: 8px 8px 0 var(--ink)                                          │
│  - 最大宽度: 560px                                                      │
│  - 入场动画: scale(0.95) → scale(1) + opacity, 150ms                   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 变体

| 变体 | 标题栏颜色 | 用途 |
|-----|----------|------|
| `default` | Ink | 普通信息/确认 |
| `danger` | RebelRed | 破坏性操作确认 |
| `success` | Acid | 成功状态 |

---

## 8.4 P5Alert

### 变体

```css
.p5-alert {
  border: 4px solid var(--ink);
  padding: 12px 16px;
  display: flex;
  align-items: flex-start;
  gap: 12px;

  /* 顶部色条 */
  border-top-width: 6px;

  &.error {
    border-top-color: var(--rebel-red);
    background: #FFF0F0;
  }

  &.warning {
    border-top-color: var(--acid);
    background: #FFFBEB;
  }

  &.info {
    border-top-color: var(--electric);
    background: #EFF6FF;
  }

  .alert-icon {
    font-size: 20px;
    flex-shrink: 0;
  }

  .alert-content {
    flex: 1;
  }

  .alert-title {
    font-weight: bold;
    margin-bottom: 4px;
  }
}
```

---

## 8.5 P5Tabs

```css
.p5-tabs {
  display: flex;
  border: 4px solid var(--ink);

  .tab {
    flex: 1;
    padding: 12px 16px;
    text-align: center;
    font-family: var(--font-display);
    text-transform: uppercase;
    cursor: pointer;
    background: var(--paper);
    color: var(--ink);
    border-right: 4px solid var(--ink);
    transition: background 80ms, color 80ms;

    &:last-child {
      border-right: none;
    }

    &:hover:not(.active) {
      background: var(--concrete-200);
    }

    &.active {
      background: var(--ink);
      color: var(--paper);
      position: relative;

      /* 底部指示条 */
      &::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--rebel-red);
      }
    }
  }
}
```

---

## 8.6 P5Skeleton

```css
.p5-skeleton {
  background:
    repeating-linear-gradient(
      -45deg,
      var(--concrete-200),
      var(--concrete-200) 4px,
      var(--concrete-100) 4px,
      var(--concrete-100) 8px
    );
  border: 4px solid var(--ink);
  animation: skeleton-pulse 1.5s ease-in-out infinite;

  /* 形状变体 */
  &.text {
    height: 16px;
    border-radius: 2px;
  }

  &.title {
    height: 32px;
    width: 60%;
  }

  &.card {
    height: 120px;
  }

  &.avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
  }
}

@keyframes skeleton-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.6; }
}
```

---

## 8.7 P5Badge

```css
.p5-badge {
  display: inline-flex;
  align-items: center;
  padding: 4px 8px;
  font-family: var(--font-display);
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  border: 3px solid var(--ink);
  box-shadow: 2px 2px 0 var(--ink);

  /* 斜切角 */
  clip-path: polygon(
    0 0,
    100% 0,
    100% calc(100% - 6px),
    calc(100% - 6px) 100%,
    0 100%
  );

  /* 变体 */
  &.pro { background: var(--electric); color: var(--paper); }
  &.con { background: var(--rebel-red); color: var(--paper); }
  &.neutral { background: var(--acid); color: var(--ink); }
  &.active { background: var(--acid); color: var(--ink); }
  &.frozen { background: var(--electric); color: var(--paper); }
  &.archived { background: var(--concrete-200); color: var(--ink); }
  &.pruned { background: var(--concrete-100); color: var(--ink); text-decoration: line-through; }
}
```

---

# 第九部分：状态与错误处理

## 9.1 错误码 UI 映射

| HTTP | 错误码 | UI 呈现 | 操作引导 |
|------|--------|---------|---------|
| 402 | `INSUFFICIENT_BALANCE` | P5Alert(error) + 余额显示 | "前往「我的」管理投票" 链接 |
| 401 | `INVALID_SIGNATURE` | P5Alert(error) | "刷新页面" 或 "重新设置身份" |
| 401 | `TIMESTAMP_OUT_OF_RANGE` | P5Alert(error) | "检查设备时间" + "刷新页面" |
| 409 | `NONCE_REPLAY` | P5Alert(info) | "操作已完成" 提示 |
| 409 | `TOPIC_STATUS_DISALLOWS_WRITE` | P5Alert(warning) | 显示当前状态 + "只能撤回" |
| 409 | `ARGUMENT_PRUNED_INCREASE_FORBIDDEN` | P5Alert(warning) | "只能减少投票" |
| 429 | `RATE_LIMITED` | P5Alert(warning) + 倒计时 | 显示 `Retry-After` 秒数 |
| 403 | `TOPIC_PUBKEY_BLACKLISTED` | P5Alert(error) | "你在此议题被禁用写入" |

## 9.2 Topic 状态 UI 映射

| 状态 | Header Badge | 写入区域 | 允许操作 |
|-----|-------------|----------|---------|
| `active` | Acid 背景 "ACTIVE" | 正常显示 | 发言、增减投票 |
| `frozen` | Electric 背景 "FROZEN" | 灰色遮罩 + 提示 | 仅撤回投票 |
| `archived` | Concrete 背景 "ARCHIVED" | 隐藏 | 只读 |

## 9.3 SSE 状态处理

| 事件 | UI 响应 |
|-----|--------|
| 正常失效事件 | 3 秒去抖后静默刷新数据 |
| `reload_required(trimmed)` | 显示常驻 Banner: "数据已更新，请刷新查看" + [刷新] 按钮 |

Banner 样式:
```css
.sse-reload-banner {
  position: fixed;
  top: 56px;  /* TopBar 下方 */
  left: 0;
  right: 0;
  background: var(--acid);
  border-bottom: 4px solid var(--ink);
  padding: 12px 24px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  z-index: 100;
}
```

---

# 第十部分：动效系统

## 10.1 动效时长规范

| 类型 | 时长 | 缓动函数 |
|-----|------|---------|
| 微交互（hover/press） | 50-80ms | `ease-out` |
| 状态变化（tab/toggle） | 100-150ms | `ease-in-out` |
| 内容出现（modal/tooltip） | 120-200ms | `ease-out` |
| 复杂动画（shake/success） | 200-400ms | `cubic-bezier` |

## 10.2 核心动画定义

```css
/* Shake - 错误反馈 */
@keyframes p5-shake {
  0%, 100% { transform: translateX(0); }
  20% { transform: translateX(-8px) rotate(-1deg); }
  40% { transform: translateX(8px) rotate(1deg); }
  60% { transform: translateX(-4px) rotate(-0.5deg); }
  80% { transform: translateX(4px) rotate(0.5deg); }
}

.shake {
  animation: p5-shake 300ms ease-in-out;
}

/* Pop - 出现动画 */
@keyframes p5-pop {
  0% {
    opacity: 0;
    transform: scale(0.9) rotate(-2deg);
  }
  70% {
    transform: scale(1.02) rotate(0.5deg);
  }
  100% {
    opacity: 1;
    transform: scale(1) rotate(0);
  }
}

.pop-enter {
  animation: p5-pop 150ms ease-out forwards;
}

/* Stamp - 印章盖下 (投票成功) */
@keyframes p5-stamp {
  0% {
    opacity: 0;
    transform: scale(2) rotate(-15deg);
  }
  50% {
    opacity: 1;
    transform: scale(1.1) rotate(5deg);
  }
  100% {
    transform: scale(1) rotate(0);
  }
}

.stamp-enter {
  animation: p5-stamp 300ms cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

/* Slide - 抽屉/面板 */
@keyframes p5-slide-in {
  from {
    transform: translateX(100%);
  }
  to {
    transform: translateX(0);
  }
}

.slide-enter {
  animation: p5-slide-in 200ms ease-out forwards;
}
```

## 10.3 Reduced Motion 支持

```css
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}
```

---

# 第十一部分：验收标准

## 11.1 功能不回归（来自 PROJECT_REFERENCE.md）

- [ ] 签名 v1（path 不含 query、raw body hash、nonce 规则）不改坏
- [ ] `setVotes` 的"强幂等 + 允许撤回"语义不改坏
- [ ] SSE `reload_required(trimmed)` 必须可恢复
- [ ] `role="alert"` 语义保留
- [ ] Reply textarea、Votes slider 的测试锚点保留

## 11.2 视觉一致性检查

- [ ] 所有按钮使用 P5Button 组件
- [ ] 所有卡片使用 P5Card/P5Panel 组件
- [ ] 所有弹窗使用 P5Modal 组件
- [ ] 所有状态提示使用 P5Alert 组件
- [ ] 颜色仅引用 CSS 变量，无硬编码
- [ ] 边框宽度统一为 4px
- [ ] 阴影偏移统一为 4px 4px 0

## 11.3 交互体验检查

- [ ] 所有按钮有 hover/active/focus 状态
- [ ] 所有输入框有 focus 状态
- [ ] 错误状态有 shake 动画
- [ ] 加载状态使用 P5Skeleton
- [ ] 空态有引导性设计

## 11.4 可访问性检查

- [ ] 所有交互元素可键盘访问
- [ ] 色彩对比度 ≥ 4.5:1
- [ ] 动画尊重 `prefers-reduced-motion`
- [ ] 表单有 label 关联
- [ ] 错误有 `role="alert"`

## 11.5 回归测试流程

每次视觉更新后执行：

```bash
# 自动化测试
pnpm -C apps/web test

# 手动回归
1. 创建 topic → 检查表单样式
2. 进入 topic → 检查双栏布局
3. 切换 ViewMode → 检查 tabs 样式
4. 选中节点 → 检查 Calling Card
5. 投票 → 检查 Slider + 确认动画
6. 发言 → 检查 TipTap 编辑器
7. 错误触发 → 检查 Alert 样式
8. My 页面 → 检查一键撤回
9. SSE 触发 → 检查 reload banner
```

---

# 第十二部分：实施路径

## Phase 0：基础设施（预计 1 天）

- [ ] 配置外部字体加载（Bebas Neue, LXGW WenKai）
- [ ] 完善 CSS 变量体系
- [ ] 更新 P5Shell 背景材质

## Phase 1：核心组件（预计 2-3 天）

- [ ] 实现 P5Slider（投票核心）
- [ ] 实现 P5Modal（统一弹窗）
- [ ] 实现 P5Skeleton（加载骨架）
- [ ] 更新 P5Tabs（增加指示条）

## Phase 2：页面架构（预计 2-3 天）

- [ ] Topic 详情页改为双栏布局
- [ ] 实现 Selected Node Card
- [ ] 实现 Reply + Vote Deck
- [ ] 实现 Children List 卡片样式

## Phase 3：仪式感交互（预计 2 天）

- [ ] 投票确认 stamp 动画
- [ ] 错误 shake 动画
- [ ] Modal 入场动画
- [ ] Tooltip pop 动画

## Phase 4：身份与报告（预计 2 天）

- [ ] Identity Onboarding Modal 流程
- [ ] 共识报告展示页
- [ ] My Activity 双栏布局

## Phase 5：可视化提升（预计 2-3 天）

- [ ] FocusView 节点样式 + 直角连线
- [ ] GodView 集群区域 + Legend
- [ ] SunburstView 选中态贴纸

## Phase 6：收口与测试（持续）

- [ ] 错误码 UI 统一
- [ ] 空态/骨架屏统一
- [ ] 可访问性回归
- [ ] 性能优化

---

*文档版本: 2.0*
*最后更新: 2025-01-XX*
