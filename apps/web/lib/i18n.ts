export type Locale = "zh" | "en";

export const LOCALE_COOKIE_NAME = "epiphany_locale";
export const defaultLocale: Locale = "zh";

export function isLocale(value: unknown): value is Locale {
  return value === "zh" || value === "en";
}

export function toHtmlLang(locale: Locale): string {
  return locale === "zh" ? "zh-CN" : "en";
}

export function toDateLocale(locale: Locale): string {
  return locale === "zh" ? "zh-CN" : "en-US";
}

interface Messages {
  [key: string]: string | Messages;
}

const MESSAGES: Record<Locale, Messages> = {
  zh: {
    common: {
      skipToContent: "跳到内容",
      loading: "加载中…",
      loadingDots: "加载中…",
      loadFailed: "加载失败",
      retry: "重试",
      empty: "暂无内容",
      error: "错误",
      close: "关闭",
      cancel: "取消",
      ok: "好的",
      confirm: "确认",
      open: "打开",
      back: "返回",
      show: "显示",
      hide: "隐藏",
      save: "保存",
      saving: "保存中…",
      refresh: "刷新",
      loadMore: "加载更多",
      copied: "已复制",
      copyFailed: "复制失败",
    },
    brand: {
      description: "匿名输入 × 质量过滤 × 即时总结",
      hostedBy: "由 Epiphany 托管",
    },
    nav: {
      topics: "议题",
      my: "我的",
      language: "语言",
      zh: "中文",
      en: "EN",
    },
    status: {
      active: "活跃",
      frozen: "冻结",
      archived: "归档",
    },
    home: {
      slogan: "Collective Vibemaking,Mapped",
      heroEyebrow: "匿名、结构化、可治理的讨论",
      heroTitleLine1: "Collective Vibemaking,",
      heroTitleLine2: "Mapped",
      heroSubtitle:
        "匿名给你表达的安全感；只让观点自身赢得注意力。",
      manifesto: {
        title: "关于这个项目",
        p1: "我们不缺观点，缺的是结构；不缺热度，缺的是可追溯的推理链。Epiphany 把讨论从“信息流”改造成一张不断生长的论证地图：每个观点有位置，每个分歧可被指认，每次转向都有路径可查。",
        p2: "匿名不是为了逃避责任，而是为了让想法先于身份出现。每个议题生成独立身份，让参与者可以更自由地提出补充、反驳、以及“我也不确定但值得一想”的部分。",
        p3: "共识往往先以一种“vibe”出现：我们感觉哪里不对、哪里更重要。二次方投票为注意力定价，把强烈偏好变成有成本的表达；语义地图与阶段报告把这种集体直觉固定下来——从 vibe 到 map。",
      },
      heroBullets: {
        anonymous: "无需注册，匿名参与；每个议题独立身份",
        structure: "观点以树状结构沉淀，便于追溯与引用",
        qv: "二次方投票（QV）对齐注意力，支持调增与撤回",
        mapAi: "语义地图 + 共识报告让全局一眼可见",
      },
      learnHow: "了解如何工作",
      newTopic: "新建议题",
      browseTopics: "浏览议题",
      preview: {
        label: "产品一瞥",
        chipExplore: "探索",
        chipRead: "阅读",
        chipVote: "投票",
        chipReport: "报告",
        topicLabel: "示例议题",
        topicTitle: "我们该如何做出更好的决策？",
        topicBody: "把观点组织成可追溯的论证树，并用投票与总结把讨论推进到可执行的结论。",
        statMapLabel: "语义地图",
        statMapValue: "看见观点聚类与分歧",
        statVoteLabel: "QV 投票",
        statVoteValue: "用成本表达强度",
        statReadLabel: "沉浸阅读",
        statReadValue: "像读文章一样理解论证",
        statReportLabel: "阶段总结",
        statReportValue: "AI 生成共识报告",
      },
      sections: {
        capabilitiesTitle: "核心能力",
        capabilitiesSubtitle: "从输入到共识：每一步都可解释、可回溯。",
        howTitle: "如何开始",
        howSubtitle: "3 分钟上手：创建一个议题，分享链接即可开始。",
        useCasesTitle: "适用场景",
        useCasesSubtitle: "适用于需要“可执行共识”的复杂议题。",
      },
      features: {
        anonymous: {
          title: "匿名输入",
          body: "不需要账号；身份只在单个议题内生成。",
        },
        structured: {
          title: "结构化论证",
          body: "每条观点都有位置，讨论不再散落在楼层里。",
        },
        qv: {
          title: "二次方投票（QV）",
          body: "用成本模型过滤噪音，保留高价值内容。",
        },
        mapAi: {
          title: "语义地图 + AI 报告",
          body: "用可视化理解全局，并生成阶段性共识总结。",
        },
      },
      steps: {
        create: {
          title: "创建议题",
          body: "用一句话写下你要解决的问题。",
        },
        post: {
          title: "提交观点",
          body: "匿名发表支持/反对/补充论证。",
        },
        vote: {
          title: "投票过滤",
          body: "用 QV 表达强度，让高信号内容浮上来。",
        },
        summarize: {
          title: "阅读与总结",
          body: "用地图看全局，查看共识报告。",
        },
      },
      useCases: {
        team: {
          title: "团队决策",
          body: "把会议争论沉淀为可追溯的论证链。",
        },
        community: {
          title: "社区治理",
          body: "用投票与主持人治理让讨论可持续。",
        },
        product: {
          title: "产品 / 研究讨论",
          body: "快速收集观点，并在结构中迭代结论。",
        },
      },
      ctaTitle: "开始一个议题",
      ctaSubtitle: "从一个好问题开始，让讨论更有产出。",
      activeDiscussions: "活跃讨论",
      noActiveTopicsYet: "暂无活跃议题。",
      createFirstTopic: "创建第一个议题",
    },
    topics: {
      title: "议题",
      subtitle: "选择一个议题或创建新的。",
      newTopic: "新建议题",
      createTitle: "创建议题",
      createSubtitle: "创建议题 + 根节点（无需签名）。",
      backToList: "返回列表",
      noTopicsYet: "暂无议题。",
      untitled: "无标题",
      visitedHint: "这里显示你在本设备访问过的私密/不公开议题。",
      visitedPartialLoadFailed: "有 {{count}} 个议题无法加载（可能需要私密链接或身份）。",
      visitedEmptyTitle: "暂无已访问议题",
      visitedEmptyBody: "打开私密链接（包含 #k=…）或参与过的议题后，这里会自动出现。",
      host: "主持人",
    },
    topic: {
      report: "报告",
      manage: "管理",
      claimHost: "领取主持权",
      claiming: "领取中…",
      hostClaimed: "已领取主持权。",
      hostClaimedForTopic: "已领取该议题的主持权。",
      ledger: "账户",
      reloadRequiredTitle: "需要刷新",
      reloadRequiredMessage: "数据已更新，请刷新",
      viewMode: {
        label: "视图模式",
        focus: "聚焦",
        overview: "概览",
        god: "全局视图",
      },
    },
    managePanel: {
      title: "主持面板",
      statusLabel: "状态",
      freeze: "冻结",
      unfreeze: "解冻",
      archive: "归档",
      archivedReadonly: "归档议题为只读。",
      frozenOnlyUnfreeze: "冻结状态下只能解冻。",
      archiveConfirmTitle: "归档议题",
      archiveConfirmBody: "归档后议题将永久只读。\n\n继续？",
      commandApplied: "已应用操作。",
      visibilityTitle: "可见性",
      currentLabel: "当前",
      rotateKey: "轮换密钥",
      copyLink: "复制链接",
      link: "链接",
      linkCopied: "已复制分享链接。",
      copyFailed: "复制失败。",
      privateLinkReady: "私密链接已就绪（包含访问密钥）。请立即复制并妥善保存。",
      privateKeyMissing: "访问密钥只会在设置为私密或轮换密钥时返回一次。",
      publicHelp: "公开议题会出现在列表中。",
      unlistedHelp: "不公开列出议题需要通过链接访问。",
      rootTitle: "根节点",
      rootTitleLabel: "根标题",
      rootBodyLabel: "根正文",
      saveRoot: "保存根节点",
      pruningTitle: "修剪",
      argumentIdLabel: "节点 ID",
      pruneReasonLabel: "修剪原因（可选）",
      pruneConfirmTitle: "修剪节点",
      pruneConfirmBody: "修剪会让该节点在公开读取中不可见（但仍可撤回投票）。\n\n继续？",
      prune: "修剪",
      unprune: "取消修剪",
      blacklistTitle: "黑名单",
      targetPubkeyLabel: "目标公钥（hex）",
      hex64Placeholder: "64 位 hex 字符",
      blacklistReasonLabel: "拉黑原因（可选）",
      pubkeyInvalid: "公钥格式无效（需要 64 位 hex）",
      blacklistConfirmTitle: "拉黑公钥",
      blacklistConfirmBody: "拉黑后该公钥将无法在本议题写入（发言/投票）。\n\n继续？",
      blacklist: "拉黑",
      unblacklist: "移出黑名单",
    },
    godView: {
      loading: "正在加载语义地图…",
      empty: "暂无可用的聚类地图。",
      instructions: "滚轮缩放 · 拖拽平移 · 悬停查看详情",
      clusterIdLabel: "聚类",
      nodeId: "节点 {{id}}",
      stanceLabel: "立场",
    },
    dialogue: {
      title: "讨论",
      orderLabel: "讨论排序",
      hottest: "最热",
      newest: "最新",
      readOnlyTitle: "只读",
      nodePruned: "该节点已被修剪：只能撤回。",
      topicReadOnly: "议题只读：只能撤回。",
      topicReadOnlyWithStatus: "议题只读（{{status}}）。你仍然可以撤回投票。",
      selectNodeHint: "请选择一个节点查看回复。",
      loadingReplies: "正在加载{{order}}回复…",
      replyLabel: "回复",
      replyRequired: "需要填写回复内容",
      posting: "发布中…",
      post: "发布",
      noIdentityHint: "只读模式：请先设置身份后再回复或投票。",
      noRepliesYet: "暂无回复。",
      balance: "余额",
      votes: "票数",
      cost: "成本",
      deltaCost: "Δ成本",
      autosaveSaving: "自动保存中…",
      autosaveSavedAt: "已自动保存 {{time}}",
    },
    editor: {
      bold: "加粗",
      italic: "斜体",
      underline: "下划线",
      heading2: "二级标题",
      heading3: "三级标题",
      bulletList: "无序列表",
      orderedList: "有序列表",
      quote: "引用",
      codeBlock: "代码块",
      link: "链接",
      linkUrlPrompt: "链接地址",
    },
    sunburst: {
      ariaLabel: "旭日图",
      tooltip: {
        depth: "层级",
        children: "子节点",
      },
    },
    sunburstView: {
      instructions: "滚轮缩放 · 悬停查看 · 点击选中",
      unavailable: "暂无概览。",
    },
    stage: {
      hideToolbarAria: "隐藏工具栏",
      showToolbar: "显示工具栏",
      supportLabel: "支持度",
      decreaseVotes: "减少票数",
      increaseVotes: "增加票数",
      confirmVotes: "确认投票",
      votesRecorded: "投票已记录",
      postSuccess: "观点提交成功",
      updated: "已更新",
      notEditable: "当前不可编辑",
      openReport: "查看 AI 分析报告",
      nodesCount: "{{count}} 个节点",
      votesCount: "{{count}} 票",
      replyPlaceholder: "分享你的观点…",
      editPlaceholder: "修改你的观点…",
      editTitleAria: "编辑标题",
      inlineEditorAria: "行内编辑器",
      editArgumentAria: "编辑节点",
      titleOptionalPlaceholder: "标题（可选）",
      topicNamePlaceholder: "你在此议题的名字",
      editAiHint: "修改后会重新触发 AI 分析",
      editHotkeysHint: "Esc 取消 · ⌘/Ctrl+Enter 保存",
      saveChanges: "保存修改",
      edit: "编辑",
      submit: "提交",
      submitting: "提交中…",
      submitArgument: "提交观点",
      nameSaving: "名字保存中…",
      nameSaved: "名字已保存",
      emptyTitle: "选择一个观点来探索",
      emptyBody:
        "点击旭日图中的任意区块来查看详情并参与讨论。你也可以直接在下方提出一个新观点（默认发布在 root 下）。",
      topicReadonlyCannotPost: "该议题为只读（{{status}}），无法新增观点；仍可撤回投票。",
      confirmLeaveEdit: "你有未保存的修改，确定要离开当前编辑吗？",
      confirmCancelEdit: "你有未保存的修改，确定要取消吗？",
      votesUnit: "票",
      relatedTitle: "相关观点",
      relatedHint: "悬停预览 · 点击切换（父链/同层/子节点）",
      relatedPath: "父链",
      relatedSiblings: "同层观点",
      relatedChildren: "子观点",
    },
    errors: {
      insufficientBalance: "余额不足",
      invalidSignature: "签名验证失败，请刷新页面重试",
      localStorageUnavailable: "本地缓存不可用",
    },
    identity: {
      setupTitle: "设置身份",
      setupSubtitle: "本设备将主种子保存在本地。继续前请备份助记词。",
      modeLabel: "身份模式",
      generate: "生成",
      import: "导入",
      invalidMnemonic: "无效的助记词",
      myIdentity: "我的身份",
      generateMnemonic: "生成 12 词助记词",
      backedUp: "我已备份",
      generatedMnemonic: "已生成助记词",
      mnemonic: "助记词",
      pasteMnemonic: "粘贴你的 12/24 词助记词",
      importMnemonic: "导入助记词",
    },
    report: {
      consensusReport: "共识报告",
      generating: "生成中",
      failed: "生成失败",
      loadingReport: "正在加载报告…",
      noReportYet: "暂无报告。",
      generatingReport: "正在生成报告…",
      reportFailedTitle: "报告生成失败",
      unknownError: "未知错误",
      generateReport: "生成报告",
      generatingAction: "生成中…",
      updatedAt: "更新于 {{time}}",
      bridgeGallery: "共识桥梁（可分享）",
      copyReportLink: "复制报告链接",
      bridgeGalleryUnavailable: "暂无可分享的桥梁卡片",
      viewAllBridges: "查看全部桥梁句（{{count}}）",
      hideAllBridges: "收起桥梁句",
      reportBody: "报告正文",
      bridgeStatement: "共识桥梁",
      copyLink: "复制链接",
      copyText: "复制文本",
      openContext: "打开上下文",
      conditions: "条件",
      stepCollectSources: "收集来源",
      stepInduceRoles: "归纳角色",
      stepDraftBridges: "生成桥梁句",
      stepCritique: "多角色批评",
      stepRevise: "递归修订",
      stepRender: "渲染报告",
      footnotes: "脚注",
      footnoteAria: "脚注 {{index}}",
      sourceMissing: "缺少来源映射",
    },
    createTopic: {
      titleLabel: "标题",
      titlePlaceholder: "（可选）留空自动生成 2-10 字标题",
      titleHelp: "留空将由 AI 自动生成 2-10 字标题。",
      bodyLabel: "正文",
      visibilityLabel: "可见性",
      titleRequired: "需要填写标题",
      bodyRequired: "需要填写正文",
      visibility: {
        public: "公开",
        unlisted: "不公开列出",
        private: "私密",
      },
      visibilityHelp: "私密议题需要链接密钥（#k=…）或曾参与过该议题。",
      toastTitle: "已创建",
      toastMessage: "议题已创建。领取令牌已保存到本地（5 分钟有效）。",
      create: "创建",
      creating: "创建中…",
    },
    importIdentityModal: {
      title: "导入身份",
      confirm: "导入身份",
      label: "输入 12 个助记词（用空格分隔）",
      placeholder: "apple banana cherry ...",
      formatOk: "格式正确 ({{count}}/12 个词)",
      formatBad: "格式错误 ({{count}}/12 个词)",
      checksumOk: "校验和有效",
      checksumBad: "校验和无效",
      derivedAddress: "派生地址：",
      warningTitle: "导入将覆盖当前设备上的身份",
      warningBody: "当前身份的投票记录将无法访问（除非再次导入）",
    },
    mnemonic: {
      title: "助记词备份",
      copy: "复制",
      copied: "已复制",
      autoHide: "{{seconds}} 秒后自动隐藏",
      alertTitle: "备份提示",
      alertLine1: "助记词是恢复身份的唯一方式",
      alertLine2: "清除浏览器数据或更换设备后，未备份将永久丢失",
    },
    toast: {
      dismiss: "关闭提示",
      error: "错误",
      warning: "警告",
      success: "成功",
      info: "提示",
    },
    confirmModal: {
      confirmDanger: "确认",
      ok: "好的",
      cancel: "取消",
    },
    node: {
      emptyHint: "点击左侧节点查看详情",
      stance: {
        pro: "支持",
        con: "反对",
        neutral: "中立",
      },
      ai: "AI",
      author: "作者",
    },
    my: {
      title: "我的动态",
      identitySectionTitle: "身份管理",
      currentIdentity: "当前身份",
      identityReady: "已设置",
      identityNotSet: "未设置",
      importIdentity: "导入已有身份",
      importHint: "用于跨设备同步或恢复",
      identityAlertTitle: "身份",
      identityAlertBody: "身份尚未初始化，请刷新页面或导入已有身份。",
      visitedTopicsTitle: "已访问议题",
      localAggregate: "本地聚合",
      noHistoryTitle: "暂无参与记录",
      noHistoryBody: "去参与议题讨论吧",
      browseTopics: "浏览议题",
      topicNotFound: "议题不存在",
      signatureError: "签名错误",
      stakesTitle: "投票于 {{topic}}",
      openTopic: "打开议题",
      hostManage: "主持人管理",
      withdrawAll: "全部撤回",
      withdrawingTitle: "撤回中",
      withdrawingProgress: "撤回中… {{completed}} / {{total}}",
      withdrawSuccess: "成功撤回 {{count}} 个投票",
      withdrawFailedTitle: "撤回失败",
      withdrawFailed: "{{count}} 个投票撤回失败",
      retryFailed: "重试失败项",
      stakesLoading: "加载投票记录…",
      stakesEmpty: "此议题暂无投票记录",
      untitled: "无标题",
      pruned: "已修剪",
      votesLabel: "票数",
      costLabel: "花费",
    },
    globalError: {
      title: "出现错误",
      subtitle: "运行时发生了错误。",
      backToTopics: "返回议题",
      unknownError: "未知错误",
      tryAgain: "重试",
    },
    notFound: {
      title: "页面不存在",
      subtitle: "该页面不存在。",
      backToTopics: "返回议题",
      body: "请检查链接地址，或返回议题列表。",
    },
  },
  en: {
    common: {
      skipToContent: "Skip to content",
      loading: "Loading…",
      loadingDots: "Loading…",
      loadFailed: "Load failed",
      retry: "Retry",
      empty: "Empty",
      error: "Error",
      close: "Close",
      cancel: "Cancel",
      ok: "OK",
      confirm: "Confirm",
      open: "Open",
      back: "Back",
      show: "Show",
      hide: "Hide",
      save: "Save",
      saving: "Saving…",
      refresh: "Refresh",
      loadMore: "Load more",
      copied: "Copied",
      copyFailed: "Copy failed",
    },
    brand: {
      description: "Anonymous Input × Quality Filter × Instant Summary",
      hostedBy: "Hosted by Epiphany",
    },
    nav: {
      topics: "Topics",
      my: "My",
      language: "Language",
      zh: "中文",
      en: "EN",
    },
    status: {
      active: "active",
      frozen: "frozen",
      archived: "archived",
    },
    home: {
      slogan: "Collective Vibemaking,Mapped",
      heroEyebrow: "Anonymous, structured, governable discussions",
      heroTitleLine1: "Collective Vibemaking,",
      heroTitleLine2: "Mapped",
      heroSubtitle:
        "Anonymity gives you the safety to speak; only ideas earn attention.",
      manifesto: {
        title: "About the project",
        p1: "We don’t lack opinions — we lack structure. Feeds make it easy to speak and hard to remember. Epiphany treats discussion as an evolving argument map: every claim has a place, every disagreement is addressable, and every shift has a traceable path.",
        p2: "Anonymity isn’t an excuse; it’s a tool. Each topic generates its own identity so ideas can arrive before status — including the half-formed “I’m not sure, but it matters” kind.",
        p3: "Consensus often shows up first as a vibe: we sense what’s off and what’s important. Quadratic voting prices attention, turning intensity into a costly signal; semantic maps and stage reports then pin that collective intuition down — from vibe to map.",
      },
      heroBullets: {
        anonymous: "No sign-up; identity is scoped to each topic",
        structure: "Arguments live in a traceable tree, not a feed",
        qv: "Quadratic voting (QV) aligns attention with value",
        mapAi: "Semantic map + reports make the big picture obvious",
      },
      learnHow: "How it works",
      newTopic: "New topic",
      browseTopics: "Browse topics",
      preview: {
        label: "Product preview",
        chipExplore: "Explore",
        chipRead: "Read",
        chipVote: "Vote",
        chipReport: "Report",
        topicLabel: "Example topic",
        topicTitle: "How should we make better decisions?",
        topicBody: "Organize viewpoints into a traceable tree, then vote and summarize toward action.",
        statMapLabel: "Semantic map",
        statMapValue: "See clusters and disagreements",
        statVoteLabel: "QV voting",
        statVoteValue: "Express intensity with cost",
        statReadLabel: "Reading mode",
        statReadValue: "Understand arguments like an essay",
        statReportLabel: "Synthesis",
        statReportValue: "AI-generated consensus report",
      },
      sections: {
        capabilitiesTitle: "Core capabilities",
        capabilitiesSubtitle: "From input to consensus — explainable and traceable.",
        howTitle: "Get started",
        howSubtitle: "Start in minutes: create a topic and share the link.",
        useCasesTitle: "Great for",
        useCasesSubtitle: "When you need consensus you can act on.",
      },
      features: {
        anonymous: {
          title: "Anonymous input",
          body: "No accounts; identity is per-topic.",
        },
        structured: {
          title: "Structured arguments",
          body: "Every point has a place in the tree — easy to follow and reference.",
        },
        qv: {
          title: "Quadratic voting (QV)",
          body: "A cost model that surfaces high-signal content.",
        },
        mapAi: {
          title: "Semantic map + AI report",
          body: "See the whole landscape and read periodic synthesis.",
        },
      },
      steps: {
        create: {
          title: "Create a topic",
          body: "Write the question you want to resolve.",
        },
        post: {
          title: "Post arguments",
          body: "Add pro/con points or supporting context.",
        },
        vote: {
          title: "Vote to filter",
          body: "Use QV to surface what matters most.",
        },
        summarize: {
          title: "Read & synthesize",
          body: "Explore the map and open the report.",
        },
      },
      useCases: {
        team: {
          title: "Team decisions",
          body: "Turn meetings into a living argument record.",
        },
        community: {
          title: "Community governance",
          body: "Keep debates productive with voting + host controls.",
        },
        product: {
          title: "Product / research",
          body: "Collect viewpoints quickly and iterate in structure.",
        },
      },
      ctaTitle: "Start a topic",
      ctaSubtitle: "Begin with a good question and build clarity together.",
      activeDiscussions: "Active discussions",
      noActiveTopicsYet: "No active topics yet.",
      createFirstTopic: "Create the first topic",
    },
    topics: {
      title: "Topics",
      subtitle: "Pick a topic or start a new one.",
      newTopic: "New topic",
      createTitle: "Create topic",
      createSubtitle: "Create a Topic + Root argument (no signature required).",
      backToList: "Back to list",
      noTopicsYet: "No topics yet.",
      untitled: "Untitled",
      visitedHint: "Shows private/unlisted topics you visited on this device.",
      visitedPartialLoadFailed: "{{count}} topics couldn’t be loaded (may require a private link or identity).",
      visitedEmptyTitle: "No visited topics yet.",
      visitedEmptyBody: "Open a private link (with #k=…) or participate in a topic, and it will appear here.",
      host: "host",
    },
    topic: {
      report: "Report",
      manage: "Manage",
      claimHost: "Claim host",
      claiming: "Claiming…",
      hostClaimed: "Host claimed.",
      hostClaimedForTopic: "Host claimed for this topic.",
      ledger: "Ledger",
      reloadRequiredTitle: "Reload required",
      reloadRequiredMessage: "Data updated, please reload.",
      viewMode: {
        label: "View mode",
        focus: "Focus",
        overview: "Overview",
        god: "God view",
      },
    },
    managePanel: {
      title: "Host deck",
      statusLabel: "Status",
      freeze: "Freeze",
      unfreeze: "Unfreeze",
      archive: "Archive",
      archivedReadonly: "Archived topics are read-only.",
      frozenOnlyUnfreeze: "Frozen topics only allow unfreeze.",
      archiveConfirmTitle: "Archive topic",
      archiveConfirmBody: "This will make the topic permanently read-only.\n\nContinue?",
      commandApplied: "Command applied.",
      visibilityTitle: "Visibility",
      currentLabel: "Current",
      rotateKey: "Rotate key",
      copyLink: "Copy link",
      link: "Link",
      linkCopied: "Share link copied.",
      copyFailed: "Copy failed.",
      privateLinkReady: "Private link is ready (includes access key). Copy it now and store it safely.",
      privateKeyMissing: "The access key is only returned once (on set private / rotate).",
      publicHelp: "Public topics are listed.",
      unlistedHelp: "Unlisted topics require a link to access.",
      rootTitle: "Root",
      rootTitleLabel: "Root title",
      rootBodyLabel: "Root body",
      saveRoot: "Save root",
      pruningTitle: "Pruning",
      argumentIdLabel: "Argument ID",
      pruneReasonLabel: "Prune reason (optional)",
      pruneConfirmTitle: "Prune argument",
      pruneConfirmBody:
        "This will hide the argument from public reads (stakes can still be withdrawn).\n\nContinue?",
      prune: "Prune",
      unprune: "Unprune",
      blacklistTitle: "Blacklist",
      targetPubkeyLabel: "Target pubkey (hex)",
      hex64Placeholder: "64 hex chars",
      blacklistReasonLabel: "Blacklist reason (optional)",
      pubkeyInvalid: "Pubkey must be 64 hex chars",
      blacklistConfirmTitle: "Blacklist pubkey",
      blacklistConfirmBody:
        "This will block the pubkey from writing (createArgument/setVotes) in this topic.\n\nContinue?",
      blacklist: "Blacklist",
      unblacklist: "Unblacklist",
    },
    godView: {
      loading: "Loading semantic map…",
      empty: "No cluster map available yet.",
      instructions: "Wheel to zoom · Drag to pan · Hover for details",
      clusterIdLabel: "Cluster",
      nodeId: "Node {{id}}",
      stanceLabel: "Stance",
    },
    dialogue: {
      title: "Dialogue",
      orderLabel: "Dialogue order",
      hottest: "Hottest",
      newest: "Newest",
      readOnlyTitle: "Read-only",
      nodePruned: "This node is pruned: you can only withdraw.",
      topicReadOnly: "Topic is read-only: you can only withdraw.",
      topicReadOnlyWithStatus: "Topic is read-only ({{status}}). You can still withdraw votes.",
      selectNodeHint: "Select a node to view replies.",
      loadingReplies: "Loading {{order}} replies…",
      replyLabel: "Reply",
      replyRequired: "Reply is required",
      posting: "Posting…",
      post: "Post",
      noIdentityHint: "Read-only mode. Set up your identity to reply or vote.",
      noRepliesYet: "No replies yet.",
      balance: "Balance",
      votes: "Votes",
      cost: "Cost",
      deltaCost: "ΔCost",
      autosaveSaving: "Autosaving…",
      autosaveSavedAt: "Autosaved {{time}}",
    },
    editor: {
      bold: "Bold",
      italic: "Italic",
      underline: "Underline",
      heading2: "Heading 2",
      heading3: "Heading 3",
      bulletList: "• List",
      orderedList: "1. List",
      quote: "Quote",
      codeBlock: "Code block",
      link: "Link",
      linkUrlPrompt: "Link URL",
    },
    sunburst: {
      ariaLabel: "Sunburst",
      tooltip: {
        depth: "depth",
        children: "children",
      },
    },
    sunburstView: {
      instructions: "Wheel to zoom · Hover for details · Click to select",
      unavailable: "Overview unavailable.",
    },
    stage: {
      hideToolbarAria: "Hide toolbar",
      showToolbar: "Show toolbar",
      supportLabel: "Support",
      decreaseVotes: "Decrease votes",
      increaseVotes: "Increase votes",
      confirmVotes: "Confirm votes",
      votesRecorded: "Votes recorded",
      postSuccess: "Post submitted",
      updated: "Updated",
      notEditable: "Not editable right now",
      openReport: "View AI report",
      nodesCount: "{{count}} nodes",
      votesCount: "{{count}} votes",
      replyPlaceholder: "Share your view…",
      editPlaceholder: "Edit your view…",
      editTitleAria: "Edit title",
      inlineEditorAria: "Inline editor",
      editArgumentAria: "Edit argument",
      titleOptionalPlaceholder: "Title (optional)",
      topicNamePlaceholder: "Your name in this topic",
      editAiHint: "Edits will re-trigger AI analysis",
      editHotkeysHint: "Esc to cancel · ⌘/Ctrl+Enter to save",
      saveChanges: "Save changes",
      edit: "Edit",
      submit: "Submit",
      submitting: "Submitting…",
      submitArgument: "Submit argument",
      nameSaving: "Saving name…",
      nameSaved: "Name saved",
      emptyTitle: "Select an argument to explore",
      emptyBody:
        "Click any segment in the sunburst to view details and join the discussion. You can also post a new argument below (defaults to root).",
      topicReadonlyCannotPost: "Topic is read-only ({{status}}). You can’t post new arguments, but you can withdraw votes.",
      confirmLeaveEdit: "You have unsaved changes. Leave editing?",
      confirmCancelEdit: "You have unsaved changes. Cancel editing?",
      votesUnit: "votes",
      relatedTitle: "Related",
      relatedHint: "Hover to preview · Click to switch",
      relatedPath: "Path",
      relatedSiblings: "Siblings",
      relatedChildren: "Replies",
    },
    errors: {
      insufficientBalance: "Insufficient balance",
      invalidSignature: "Invalid signature. Please reload and try again.",
      localStorageUnavailable: "Local storage unavailable",
    },
    identity: {
      setupTitle: "Set up your identity",
      setupSubtitle:
        "This device stores your master seed locally. Back up the mnemonic before continuing.",
      modeLabel: "Identity mode",
      generate: "Generate",
      import: "Import",
      invalidMnemonic: "Invalid mnemonic",
      myIdentity: "My identity",
      generateMnemonic: "Generate 12-word mnemonic",
      backedUp: "I have backed it up",
      generatedMnemonic: "Generated mnemonic",
      mnemonic: "Mnemonic",
      pasteMnemonic: "Paste your 12/24-word mnemonic",
      importMnemonic: "Import mnemonic",
    },
    report: {
      consensusReport: "Consensus report",
      generating: "generating",
      failed: "failed",
      loadingReport: "Loading report…",
      noReportYet: "No report yet.",
      generatingReport: "Generating report…",
      reportFailedTitle: "Report failed",
      unknownError: "Unknown error",
      generateReport: "Generate report",
      generatingAction: "Generating…",
      updatedAt: "Updated {{time}}",
      bridgeGallery: "Bridge statements (shareable)",
      copyReportLink: "Copy report link",
      bridgeGalleryUnavailable: "No shareable bridge cards available",
      viewAllBridges: "View all bridges ({{count}})",
      hideAllBridges: "Hide bridges",
      reportBody: "Report body",
      bridgeStatement: "Bridge statement",
      copyLink: "Copy link",
      copyText: "Copy text",
      openContext: "Open context",
      conditions: "Conditions",
      stepCollectSources: "Collect sources",
      stepInduceRoles: "Induce roles",
      stepDraftBridges: "Draft bridges",
      stepCritique: "Multi-role critique",
      stepRevise: "Revise",
      stepRender: "Render report",
      footnotes: "Footnotes",
      footnoteAria: "Footnote {{index}}",
      sourceMissing: "Source mapping missing",
    },
    createTopic: {
      titleLabel: "Title",
      titlePlaceholder: "(optional) Leave blank to auto-generate (2–10 chars)",
      titleHelp: "Leave blank and AI will generate a 2–10 character title.",
      bodyLabel: "Body",
      visibilityLabel: "Visibility",
      titleRequired: "Title is required",
      bodyRequired: "Body is required",
      visibility: {
        public: "public",
        unlisted: "unlisted",
        private: "private",
      },
      visibilityHelp: "Private topics require a link key (#k=…) or prior participation.",
      toastTitle: "created",
      toastMessage: "Topic created. Claim token saved locally for 5 minutes.",
      create: "Create",
      creating: "Creating…",
    },
    importIdentityModal: {
      title: "Import identity",
      confirm: "Import identity",
      label: "Enter 12 mnemonic words (space-separated)",
      placeholder: "apple banana cherry ...",
      formatOk: "Format OK ({{count}}/12 words)",
      formatBad: "Format invalid ({{count}}/12 words)",
      checksumOk: "Checksum valid",
      checksumBad: "Checksum invalid",
      derivedAddress: "Derived address:",
      warningTitle: "Import will overwrite this device’s identity",
      warningBody: "Your current identity’s voting history will be inaccessible (unless you import again).",
    },
    mnemonic: {
      title: "Mnemonic backup",
      copy: "Copy",
      copied: "Copied",
      autoHide: "Auto-hide in {{seconds}}s",
      alertTitle: "Backup reminder",
      alertLine1: "The mnemonic is the only way to recover your identity",
      alertLine2: "If you clear browser data or switch devices, you may lose access permanently",
    },
    toast: {
      dismiss: "Dismiss toast",
      error: "error",
      warning: "warning",
      success: "success",
      info: "info",
    },
    confirmModal: {
      confirmDanger: "Confirm",
      ok: "OK",
      cancel: "Cancel",
    },
    node: {
      emptyHint: "Click a node on the left to see details",
      stance: {
        pro: "pro",
        con: "con",
        neutral: "neutral",
      },
      ai: "AI",
      author: "Author",
    },
    my: {
      title: "My Activity",
      identitySectionTitle: "Identity",
      currentIdentity: "Current identity",
      identityReady: "Ready",
      identityNotSet: "Not set",
      importIdentity: "Import existing identity",
      importHint: "For cross-device sync or recovery",
      identityAlertTitle: "Identity",
      identityAlertBody: "Identity is not initialized. Please refresh or import an existing identity.",
      visitedTopicsTitle: "Visited topics",
      localAggregate: "Local aggregation",
      noHistoryTitle: "No activity yet",
      noHistoryBody: "Join a topic to get started",
      browseTopics: "Browse topics",
      topicNotFound: "Topic not found",
      signatureError: "Signature error",
      stakesTitle: "Votes in {{topic}}",
      openTopic: "Open topic",
      hostManage: "Host manage",
      withdrawAll: "Withdraw all",
      withdrawingTitle: "Withdrawing",
      withdrawingProgress: "Withdrawing… {{completed}} / {{total}}",
      withdrawSuccess: "Withdrew {{count}} votes",
      withdrawFailedTitle: "Withdraw failed",
      withdrawFailed: "{{count}} votes failed to withdraw",
      retryFailed: "Retry failed",
      stakesLoading: "Loading vote history…",
      stakesEmpty: "No vote history in this topic",
      untitled: "Untitled",
      pruned: "Pruned",
      votesLabel: "Votes",
      costLabel: "Cost",
    },
    globalError: {
      title: "Something went wrong",
      subtitle: "A runtime error occurred.",
      backToTopics: "Back to topics",
      unknownError: "Unknown error",
      tryAgain: "Try again",
    },
    notFound: {
      title: "Not found",
      subtitle: "This page does not exist.",
      backToTopics: "Back to topics",
      body: "Check the URL, or go back to the topics list.",
    },
  },
};

function getByPath(root: Messages, path: string[]): string | Messages | null {
  let current: string | Messages | undefined = root;
  for (const segment of path) {
    if (!current || typeof current !== "object") return null;
    current = (current as Messages)[segment];
  }
  return current ?? null;
}

function interpolate(template: string, params: Record<string, string | number>): string {
  let out = template;
  for (const [key, value] of Object.entries(params)) {
    out = out.replaceAll(`{{${key}}}`, String(value));
  }
  return out;
}

export function t(locale: Locale, key: string, params?: Record<string, string | number>): string {
  const path = key.split(".").filter(Boolean);
  const candidate = getByPath(MESSAGES[locale], path);
  const fallback = getByPath(MESSAGES.en, path);
  const raw = typeof candidate === "string" ? candidate : typeof fallback === "string" ? fallback : key;
  return params ? interpolate(raw, params) : raw;
}

export function createTranslator(locale: Locale) {
  return (key: string, params?: Record<string, string | number>) => t(locale, key, params);
}
