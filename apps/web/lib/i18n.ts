export type Locale = "zh" | "en";

export const LOCALE_COOKIE_NAME = "epiphany_locale";
export const defaultLocale: Locale = "zh";

export function isLocale(value: unknown): value is Locale {
  return value === "zh" || value === "en";
}

export function toHtmlLang(locale: Locale): string {
  return locale === "zh" ? "zh-CN" : "en";
}

export function toDateLocale(locale: Locale): string {
  return locale === "zh" ? "zh-CN" : "en-US";
}

interface Messages {
  [key: string]: string | Messages;
}

const MESSAGES: Record<Locale, Messages> = {
  zh: {
    common: {
      skipToContent: "跳到内容",
      loading: "加载中…",
      loadingDots: "加载中…",
      loadFailed: "加载失败",
      empty: "暂无内容",
      error: "错误",
      close: "关闭",
      cancel: "取消",
      ok: "好的",
      confirm: "确认",
      open: "打开",
      back: "返回",
      show: "显示",
      hide: "隐藏",
      save: "保存",
      saving: "保存中…",
      refresh: "刷新",
      loadMore: "加载更多",
    },
    brand: {
      description: "匿名输入 × 质量过滤 × 即时总结",
      hostedBy: "由 Epiphany 托管",
    },
    nav: {
      topics: "议题",
      my: "我的",
      language: "语言",
      zh: "中文",
      en: "EN",
    },
    status: {
      active: "活跃",
      frozen: "冻结",
      archived: "归档",
    },
    home: {
      heroTitleLine1: "集体灵感共创，",
      heroTitleLine2: "映射呈现",
      newTopic: "新建议题",
      browseTopics: "浏览议题",
      activeDiscussions: "活跃讨论",
      noActiveTopicsYet: "暂无活跃议题。",
      createFirstTopic: "创建第一个议题",
    },
    topics: {
      title: "议题",
      subtitle: "选择一个议题或创建新的。",
      newTopic: "新建议题",
      createTitle: "创建议题",
      createSubtitle: "创建议题 + 根节点（无需签名）。",
      backToList: "返回列表",
      noTopicsYet: "暂无议题。",
      untitled: "无标题",
      visitedHint: "这里显示你在本设备访问过的私密/不公开议题。",
      visitedPartialLoadFailed: "有 {{count}} 个议题无法加载（可能需要私密链接或身份）。",
      visitedEmptyTitle: "暂无已访问议题",
      visitedEmptyBody: "打开私密链接（包含 #k=…）或参与过的议题后，这里会自动出现。",
      host: "主持人",
    },
    topic: {
      report: "报告",
      manage: "管理",
      claimHost: "领取主持权",
      claiming: "领取中…",
      hostClaimed: "已领取主持权。",
      hostClaimedForTopic: "已领取该议题的主持权。",
      ledger: "账户",
      reloadRequiredTitle: "需要刷新",
      reloadRequiredMessage: "数据已更新，请刷新",
      viewMode: {
        label: "视图模式",
        focus: "聚焦",
        overview: "概览",
        god: "全局视图",
      },
    },
    managePanel: {
      title: "主持面板",
      statusLabel: "状态",
      freeze: "冻结",
      unfreeze: "解冻",
      archive: "归档",
      archivedReadonly: "归档议题为只读。",
      frozenOnlyUnfreeze: "冻结状态下只能解冻。",
      archiveConfirmTitle: "归档议题",
      archiveConfirmBody: "归档后议题将永久只读。\n\n继续？",
      commandApplied: "已应用操作。",
      visibilityTitle: "可见性",
      currentLabel: "当前",
      rotateKey: "轮换密钥",
      copyLink: "复制链接",
      link: "链接",
      linkCopied: "已复制分享链接。",
      copyFailed: "复制失败。",
      privateLinkReady: "私密链接已就绪（包含访问密钥）。请立即复制并妥善保存。",
      privateKeyMissing: "访问密钥只会在设置为私密或轮换密钥时返回一次。",
      publicHelp: "公开议题会出现在列表中。",
      unlistedHelp: "不公开列出议题需要通过链接访问。",
      rootTitle: "根节点",
      rootTitleLabel: "根标题",
      rootBodyLabel: "根正文",
      saveRoot: "保存根节点",
      pruningTitle: "修剪",
      argumentIdLabel: "节点 ID",
      pruneReasonLabel: "修剪原因（可选）",
      pruneConfirmTitle: "修剪节点",
      pruneConfirmBody: "修剪会让该节点在公开读取中不可见（但仍可撤回投票）。\n\n继续？",
      prune: "修剪",
      unprune: "取消修剪",
      blacklistTitle: "黑名单",
      targetPubkeyLabel: "目标公钥（hex）",
      hex64Placeholder: "64 位 hex 字符",
      blacklistReasonLabel: "拉黑原因（可选）",
      pubkeyInvalid: "公钥格式无效（需要 64 位 hex）",
      blacklistConfirmTitle: "拉黑公钥",
      blacklistConfirmBody: "拉黑后该公钥将无法在本议题写入（发言/投票）。\n\n继续？",
      blacklist: "拉黑",
      unblacklist: "移出黑名单",
    },
    godView: {
      loading: "正在加载语义地图…",
      empty: "暂无可用的聚类地图。",
      instructions: "滚轮缩放 · 拖拽平移 · 悬停查看详情",
      clusterIdLabel: "聚类",
      nodeId: "节点 {{id}}",
      stanceLabel: "立场",
    },
    dialogue: {
      title: "讨论",
      orderLabel: "讨论排序",
      hottest: "最热",
      newest: "最新",
      readOnlyTitle: "只读",
      nodePruned: "该节点已被修剪：只能撤回。",
      topicReadOnly: "议题只读：只能撤回。",
      topicReadOnlyWithStatus: "议题只读（{{status}}）。你仍然可以撤回投票。",
      selectNodeHint: "请选择一个节点查看回复。",
      loadingReplies: "正在加载{{order}}回复…",
      replyLabel: "回复",
      replyRequired: "需要填写回复内容",
      posting: "发布中…",
      post: "发布",
      noIdentityHint: "只读模式：请先设置身份后再回复或投票。",
      noRepliesYet: "暂无回复。",
      balance: "余额",
      votes: "票数",
      cost: "成本",
      deltaCost: "Δ成本",
      autosaveSaving: "自动保存中…",
      autosaveSavedAt: "已自动保存 {{time}}",
    },
    editor: {
      bold: "加粗",
      italic: "斜体",
      underline: "下划线",
      heading2: "二级标题",
      heading3: "三级标题",
      bulletList: "无序列表",
      orderedList: "有序列表",
      quote: "引用",
      codeBlock: "代码块",
      link: "链接",
      linkUrlPrompt: "链接地址",
    },
    sunburst: {
      ariaLabel: "旭日图",
      tooltip: {
        depth: "层级",
        children: "子节点",
      },
    },
    sunburstView: {
      instructions: "滚轮缩放 · 悬停查看 · 点击选中",
      unavailable: "暂无概览。",
    },
    stage: {
      hideToolbarAria: "隐藏工具栏",
      showToolbar: "显示工具栏",
      supportLabel: "支持度",
      decreaseVotes: "减少票数",
      increaseVotes: "增加票数",
      confirmVotes: "确认投票",
      votesRecorded: "投票已记录",
      postSuccess: "观点提交成功",
      updated: "已更新",
      notEditable: "当前不可编辑",
      openReport: "查看 AI 分析报告",
      nodesCount: "{{count}} 个节点",
      votesCount: "{{count}} 票",
      replyPlaceholder: "分享你的观点…",
      editPlaceholder: "修改你的观点…",
      editTitleAria: "编辑标题",
      inlineEditorAria: "行内编辑器",
      editArgumentAria: "编辑节点",
      titleOptionalPlaceholder: "标题（可选）",
      topicNamePlaceholder: "你在此议题的名字",
      editAiHint: "修改后会重新触发 AI 分析",
      editHotkeysHint: "Esc 取消 · ⌘/Ctrl+Enter 保存",
      saveChanges: "保存修改",
      edit: "编辑",
      submit: "提交",
      submitting: "提交中…",
      submitArgument: "提交观点",
      nameSaving: "名字保存中…",
      nameSaved: "名字已保存",
      emptyTitle: "选择一个观点来探索",
      emptyBody:
        "点击旭日图中的任意区块来查看详情并参与讨论。你也可以直接在下方提出一个新观点（默认发布在 root 下）。",
      topicReadonlyCannotPost: "该议题为只读（{{status}}），无法新增观点；仍可撤回投票。",
      confirmLeaveEdit: "你有未保存的修改，确定要离开当前编辑吗？",
      confirmCancelEdit: "你有未保存的修改，确定要取消吗？",
      votesUnit: "票",
    },
    errors: {
      insufficientBalance: "余额不足",
      invalidSignature: "签名验证失败，请刷新页面重试",
      localStorageUnavailable: "本地缓存不可用",
    },
    identity: {
      setupTitle: "设置身份",
      setupSubtitle: "本设备将主种子保存在本地。继续前请备份助记词。",
      modeLabel: "身份模式",
      generate: "生成",
      import: "导入",
      invalidMnemonic: "无效的助记词",
      myIdentity: "我的身份",
      generateMnemonic: "生成 12 词助记词",
      backedUp: "我已备份",
      generatedMnemonic: "已生成助记词",
      mnemonic: "助记词",
      pasteMnemonic: "粘贴你的 12/24 词助记词",
      importMnemonic: "导入助记词",
    },
    report: {
      consensusReport: "共识报告",
      generating: "生成中",
      failed: "生成失败",
      loadingReport: "正在加载报告…",
      noReportYet: "暂无报告。",
      generatingReport: "正在生成报告…",
      reportFailedTitle: "报告生成失败",
      unknownError: "未知错误",
      generateReport: "生成报告",
      generatingAction: "生成中…",
      footnotes: "脚注",
      footnoteAria: "脚注 {{index}}",
      sourceMissing: "缺少来源映射",
    },
    createTopic: {
      titleLabel: "标题",
      bodyLabel: "正文",
      visibilityLabel: "可见性",
      titleRequired: "需要填写标题",
      bodyRequired: "需要填写正文",
      visibility: {
        public: "公开",
        unlisted: "不公开列出",
        private: "私密",
      },
      visibilityHelp: "私密议题需要链接密钥（#k=…）或曾参与过该议题。",
      toastTitle: "已创建",
      toastMessage: "议题已创建。领取令牌已保存到本地（5 分钟有效）。",
      create: "创建",
      creating: "创建中…",
    },
    importIdentityModal: {
      title: "导入身份",
      confirm: "导入身份",
      label: "输入 12 个助记词（用空格分隔）",
      placeholder: "apple banana cherry ...",
      formatOk: "格式正确 ({{count}}/12 个词)",
      formatBad: "格式错误 ({{count}}/12 个词)",
      checksumOk: "校验和有效",
      checksumBad: "校验和无效",
      derivedAddress: "派生地址：",
      warningTitle: "导入将覆盖当前设备上的身份",
      warningBody: "当前身份的投票记录将无法访问（除非再次导入）",
    },
    mnemonic: {
      title: "助记词备份",
      copy: "复制",
      copied: "已复制",
      autoHide: "{{seconds}} 秒后自动隐藏",
      alertTitle: "备份提示",
      alertLine1: "助记词是恢复身份的唯一方式",
      alertLine2: "清除浏览器数据或更换设备后，未备份将永久丢失",
    },
    toast: {
      dismiss: "关闭提示",
      error: "错误",
      warning: "警告",
      success: "成功",
      info: "提示",
    },
    confirmModal: {
      confirmDanger: "确认",
      ok: "好的",
      cancel: "取消",
    },
    node: {
      emptyHint: "点击左侧节点查看详情",
      stance: {
        pro: "支持",
        con: "反对",
        neutral: "中立",
      },
      ai: "AI",
      author: "作者",
    },
    my: {
      title: "我的动态",
      identitySectionTitle: "身份管理",
      currentIdentity: "当前身份",
      identityReady: "已设置",
      identityNotSet: "未设置",
      importIdentity: "导入已有身份",
      importHint: "用于跨设备同步或恢复",
      identityAlertTitle: "身份",
      identityAlertBody: "身份尚未初始化，请刷新页面或导入已有身份。",
      visitedTopicsTitle: "已访问议题",
      localAggregate: "本地聚合",
      noHistoryTitle: "暂无参与记录",
      noHistoryBody: "去参与议题讨论吧",
      browseTopics: "浏览议题",
      topicNotFound: "议题不存在",
      signatureError: "签名错误",
      stakesTitle: "投票于 {{topic}}",
      openTopic: "打开议题",
      hostManage: "主持人管理",
      withdrawAll: "全部撤回",
      withdrawingTitle: "撤回中",
      withdrawingProgress: "撤回中… {{completed}} / {{total}}",
      withdrawSuccess: "成功撤回 {{count}} 个投票",
      withdrawFailedTitle: "撤回失败",
      withdrawFailed: "{{count}} 个投票撤回失败",
      retryFailed: "重试失败项",
      stakesLoading: "加载投票记录…",
      stakesEmpty: "此议题暂无投票记录",
      untitled: "无标题",
      pruned: "已修剪",
      votesLabel: "票数",
      costLabel: "花费",
    },
    globalError: {
      title: "出现错误",
      subtitle: "运行时发生了错误。",
      backToTopics: "返回议题",
      unknownError: "未知错误",
      tryAgain: "重试",
    },
    notFound: {
      title: "页面不存在",
      subtitle: "该页面不存在。",
      backToTopics: "返回议题",
      body: "请检查链接地址，或返回议题列表。",
    },
  },
  en: {
    common: {
      skipToContent: "Skip to content",
      loading: "Loading…",
      loadingDots: "Loading…",
      loadFailed: "Load failed",
      empty: "Empty",
      error: "Error",
      close: "Close",
      cancel: "Cancel",
      ok: "OK",
      confirm: "Confirm",
      open: "Open",
      back: "Back",
      show: "Show",
      hide: "Hide",
      save: "Save",
      saving: "Saving…",
      refresh: "Refresh",
      loadMore: "Load more",
    },
    brand: {
      description: "Anonymous Input × Quality Filter × Instant Summary",
      hostedBy: "Hosted by Epiphany",
    },
    nav: {
      topics: "Topics",
      my: "My",
      language: "Language",
      zh: "中文",
      en: "EN",
    },
    status: {
      active: "active",
      frozen: "frozen",
      archived: "archived",
    },
    home: {
      heroTitleLine1: "Collective vibemaking,",
      heroTitleLine2: "mapped",
      newTopic: "New topic",
      browseTopics: "Browse topics",
      activeDiscussions: "Active discussions",
      noActiveTopicsYet: "No active topics yet.",
      createFirstTopic: "Create the first topic",
    },
    topics: {
      title: "Topics",
      subtitle: "Pick a topic or start a new one.",
      newTopic: "New topic",
      createTitle: "Create topic",
      createSubtitle: "Create a Topic + Root argument (no signature required).",
      backToList: "Back to list",
      noTopicsYet: "No topics yet.",
      untitled: "Untitled",
      visitedHint: "Shows private/unlisted topics you visited on this device.",
      visitedPartialLoadFailed: "{{count}} topics couldn’t be loaded (may require a private link or identity).",
      visitedEmptyTitle: "No visited topics yet.",
      visitedEmptyBody: "Open a private link (with #k=…) or participate in a topic, and it will appear here.",
      host: "host",
    },
    topic: {
      report: "Report",
      manage: "Manage",
      claimHost: "Claim host",
      claiming: "Claiming…",
      hostClaimed: "Host claimed.",
      hostClaimedForTopic: "Host claimed for this topic.",
      ledger: "Ledger",
      reloadRequiredTitle: "Reload required",
      reloadRequiredMessage: "Data updated, please reload.",
      viewMode: {
        label: "View mode",
        focus: "Focus",
        overview: "Overview",
        god: "God view",
      },
    },
    managePanel: {
      title: "Host deck",
      statusLabel: "Status",
      freeze: "Freeze",
      unfreeze: "Unfreeze",
      archive: "Archive",
      archivedReadonly: "Archived topics are read-only.",
      frozenOnlyUnfreeze: "Frozen topics only allow unfreeze.",
      archiveConfirmTitle: "Archive topic",
      archiveConfirmBody: "This will make the topic permanently read-only.\n\nContinue?",
      commandApplied: "Command applied.",
      visibilityTitle: "Visibility",
      currentLabel: "Current",
      rotateKey: "Rotate key",
      copyLink: "Copy link",
      link: "Link",
      linkCopied: "Share link copied.",
      copyFailed: "Copy failed.",
      privateLinkReady: "Private link is ready (includes access key). Copy it now and store it safely.",
      privateKeyMissing: "The access key is only returned once (on set private / rotate).",
      publicHelp: "Public topics are listed.",
      unlistedHelp: "Unlisted topics require a link to access.",
      rootTitle: "Root",
      rootTitleLabel: "Root title",
      rootBodyLabel: "Root body",
      saveRoot: "Save root",
      pruningTitle: "Pruning",
      argumentIdLabel: "Argument ID",
      pruneReasonLabel: "Prune reason (optional)",
      pruneConfirmTitle: "Prune argument",
      pruneConfirmBody:
        "This will hide the argument from public reads (stakes can still be withdrawn).\n\nContinue?",
      prune: "Prune",
      unprune: "Unprune",
      blacklistTitle: "Blacklist",
      targetPubkeyLabel: "Target pubkey (hex)",
      hex64Placeholder: "64 hex chars",
      blacklistReasonLabel: "Blacklist reason (optional)",
      pubkeyInvalid: "Pubkey must be 64 hex chars",
      blacklistConfirmTitle: "Blacklist pubkey",
      blacklistConfirmBody:
        "This will block the pubkey from writing (createArgument/setVotes) in this topic.\n\nContinue?",
      blacklist: "Blacklist",
      unblacklist: "Unblacklist",
    },
    godView: {
      loading: "Loading semantic map…",
      empty: "No cluster map available yet.",
      instructions: "Wheel to zoom · Drag to pan · Hover for details",
      clusterIdLabel: "Cluster",
      nodeId: "Node {{id}}",
      stanceLabel: "Stance",
    },
    dialogue: {
      title: "Dialogue",
      orderLabel: "Dialogue order",
      hottest: "Hottest",
      newest: "Newest",
      readOnlyTitle: "Read-only",
      nodePruned: "This node is pruned: you can only withdraw.",
      topicReadOnly: "Topic is read-only: you can only withdraw.",
      topicReadOnlyWithStatus: "Topic is read-only ({{status}}). You can still withdraw votes.",
      selectNodeHint: "Select a node to view replies.",
      loadingReplies: "Loading {{order}} replies…",
      replyLabel: "Reply",
      replyRequired: "Reply is required",
      posting: "Posting…",
      post: "Post",
      noIdentityHint: "Read-only mode. Set up your identity to reply or vote.",
      noRepliesYet: "No replies yet.",
      balance: "Balance",
      votes: "Votes",
      cost: "Cost",
      deltaCost: "ΔCost",
      autosaveSaving: "Autosaving…",
      autosaveSavedAt: "Autosaved {{time}}",
    },
    editor: {
      bold: "Bold",
      italic: "Italic",
      underline: "Underline",
      heading2: "Heading 2",
      heading3: "Heading 3",
      bulletList: "• List",
      orderedList: "1. List",
      quote: "Quote",
      codeBlock: "Code block",
      link: "Link",
      linkUrlPrompt: "Link URL",
    },
    sunburst: {
      ariaLabel: "Sunburst",
      tooltip: {
        depth: "depth",
        children: "children",
      },
    },
    sunburstView: {
      instructions: "Wheel to zoom · Hover for details · Click to select",
      unavailable: "Overview unavailable.",
    },
    stage: {
      hideToolbarAria: "Hide toolbar",
      showToolbar: "Show toolbar",
      supportLabel: "Support",
      decreaseVotes: "Decrease votes",
      increaseVotes: "Increase votes",
      confirmVotes: "Confirm votes",
      votesRecorded: "Votes recorded",
      postSuccess: "Post submitted",
      updated: "Updated",
      notEditable: "Not editable right now",
      openReport: "View AI report",
      nodesCount: "{{count}} nodes",
      votesCount: "{{count}} votes",
      replyPlaceholder: "Share your view…",
      editPlaceholder: "Edit your view…",
      editTitleAria: "Edit title",
      inlineEditorAria: "Inline editor",
      editArgumentAria: "Edit argument",
      titleOptionalPlaceholder: "Title (optional)",
      topicNamePlaceholder: "Your name in this topic",
      editAiHint: "Edits will re-trigger AI analysis",
      editHotkeysHint: "Esc to cancel · ⌘/Ctrl+Enter to save",
      saveChanges: "Save changes",
      edit: "Edit",
      submit: "Submit",
      submitting: "Submitting…",
      submitArgument: "Submit argument",
      nameSaving: "Saving name…",
      nameSaved: "Name saved",
      emptyTitle: "Select an argument to explore",
      emptyBody:
        "Click any segment in the sunburst to view details and join the discussion. You can also post a new argument below (defaults to root).",
      topicReadonlyCannotPost: "Topic is read-only ({{status}}). You can’t post new arguments, but you can withdraw votes.",
      confirmLeaveEdit: "You have unsaved changes. Leave editing?",
      confirmCancelEdit: "You have unsaved changes. Cancel editing?",
      votesUnit: "votes",
    },
    errors: {
      insufficientBalance: "Insufficient balance",
      invalidSignature: "Invalid signature. Please reload and try again.",
      localStorageUnavailable: "Local storage unavailable",
    },
    identity: {
      setupTitle: "Set up your identity",
      setupSubtitle:
        "This device stores your master seed locally. Back up the mnemonic before continuing.",
      modeLabel: "Identity mode",
      generate: "Generate",
      import: "Import",
      invalidMnemonic: "Invalid mnemonic",
      myIdentity: "My identity",
      generateMnemonic: "Generate 12-word mnemonic",
      backedUp: "I have backed it up",
      generatedMnemonic: "Generated mnemonic",
      mnemonic: "Mnemonic",
      pasteMnemonic: "Paste your 12/24-word mnemonic",
      importMnemonic: "Import mnemonic",
    },
    report: {
      consensusReport: "Consensus report",
      generating: "generating",
      failed: "failed",
      loadingReport: "Loading report…",
      noReportYet: "No report yet.",
      generatingReport: "Generating report…",
      reportFailedTitle: "Report failed",
      unknownError: "Unknown error",
      generateReport: "Generate report",
      generatingAction: "Generating…",
      footnotes: "Footnotes",
      footnoteAria: "Footnote {{index}}",
      sourceMissing: "Source mapping missing",
    },
    createTopic: {
      titleLabel: "Title",
      bodyLabel: "Body",
      visibilityLabel: "Visibility",
      titleRequired: "Title is required",
      bodyRequired: "Body is required",
      visibility: {
        public: "public",
        unlisted: "unlisted",
        private: "private",
      },
      visibilityHelp: "Private topics require a link key (#k=…) or prior participation.",
      toastTitle: "created",
      toastMessage: "Topic created. Claim token saved locally for 5 minutes.",
      create: "Create",
      creating: "Creating…",
    },
    importIdentityModal: {
      title: "Import identity",
      confirm: "Import identity",
      label: "Enter 12 mnemonic words (space-separated)",
      placeholder: "apple banana cherry ...",
      formatOk: "Format OK ({{count}}/12 words)",
      formatBad: "Format invalid ({{count}}/12 words)",
      checksumOk: "Checksum valid",
      checksumBad: "Checksum invalid",
      derivedAddress: "Derived address:",
      warningTitle: "Import will overwrite this device’s identity",
      warningBody: "Your current identity’s voting history will be inaccessible (unless you import again).",
    },
    mnemonic: {
      title: "Mnemonic backup",
      copy: "Copy",
      copied: "Copied",
      autoHide: "Auto-hide in {{seconds}}s",
      alertTitle: "Backup reminder",
      alertLine1: "The mnemonic is the only way to recover your identity",
      alertLine2: "If you clear browser data or switch devices, you may lose access permanently",
    },
    toast: {
      dismiss: "Dismiss toast",
      error: "error",
      warning: "warning",
      success: "success",
      info: "info",
    },
    confirmModal: {
      confirmDanger: "Confirm",
      ok: "OK",
      cancel: "Cancel",
    },
    node: {
      emptyHint: "Click a node on the left to see details",
      stance: {
        pro: "pro",
        con: "con",
        neutral: "neutral",
      },
      ai: "AI",
      author: "Author",
    },
    my: {
      title: "My Activity",
      identitySectionTitle: "Identity",
      currentIdentity: "Current identity",
      identityReady: "Ready",
      identityNotSet: "Not set",
      importIdentity: "Import existing identity",
      importHint: "For cross-device sync or recovery",
      identityAlertTitle: "Identity",
      identityAlertBody: "Identity is not initialized. Please refresh or import an existing identity.",
      visitedTopicsTitle: "Visited topics",
      localAggregate: "Local aggregation",
      noHistoryTitle: "No activity yet",
      noHistoryBody: "Join a topic to get started",
      browseTopics: "Browse topics",
      topicNotFound: "Topic not found",
      signatureError: "Signature error",
      stakesTitle: "Votes in {{topic}}",
      openTopic: "Open topic",
      hostManage: "Host manage",
      withdrawAll: "Withdraw all",
      withdrawingTitle: "Withdrawing",
      withdrawingProgress: "Withdrawing… {{completed}} / {{total}}",
      withdrawSuccess: "Withdrew {{count}} votes",
      withdrawFailedTitle: "Withdraw failed",
      withdrawFailed: "{{count}} votes failed to withdraw",
      retryFailed: "Retry failed",
      stakesLoading: "Loading vote history…",
      stakesEmpty: "No vote history in this topic",
      untitled: "Untitled",
      pruned: "Pruned",
      votesLabel: "Votes",
      costLabel: "Cost",
    },
    globalError: {
      title: "Something went wrong",
      subtitle: "A runtime error occurred.",
      backToTopics: "Back to topics",
      unknownError: "Unknown error",
      tryAgain: "Try again",
    },
    notFound: {
      title: "Not found",
      subtitle: "This page does not exist.",
      backToTopics: "Back to topics",
      body: "Check the URL, or go back to the topics list.",
    },
  },
};

function getByPath(root: Messages, path: string[]): string | Messages | null {
  let current: string | Messages | undefined = root;
  for (const segment of path) {
    if (!current || typeof current !== "object") return null;
    current = (current as Messages)[segment];
  }
  return current ?? null;
}

function interpolate(template: string, params: Record<string, string | number>): string {
  let out = template;
  for (const [key, value] of Object.entries(params)) {
    out = out.replaceAll(`{{${key}}}`, String(value));
  }
  return out;
}

export function t(locale: Locale, key: string, params?: Record<string, string | number>): string {
  const path = key.split(".").filter(Boolean);
  const candidate = getByPath(MESSAGES[locale], path);
  const fallback = getByPath(MESSAGES.en, path);
  const raw = typeof candidate === "string" ? candidate : typeof fallback === "string" ? fallback : key;
  return params ? interpolate(raw, params) : raw;
}

export function createTranslator(locale: Locale) {
  return (key: string, params?: Record<string, string | number>) => t(locale, key, params);
}
